!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.nokhbe=e()}}(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}
var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}
return n[o].exports}
var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var random=require('ngraph.random');var nokhbe={lazyExtend:function(){return require('ngraph.merge').apply(this,arguments);},randomIterator:function(){return random.randomIterator.apply(random,arguments);},random:function(){return random.random.apply(random,arguments);},events:require('ngraph.events')};nokhbe.chartView={version:require('./version.js'),graph:require('ngraph.graph'),serializer:function(){return{loadFromJSON:require('ngraph.fromjson'),storeToJSON:require('ngraph.tojson')};},centrality:require('./Algorithms/centrality.js'),operations:require('./Algorithms/operations.js'),geom:function(){return{intersect:require('gintersect'),intersectRect:require('./Utils/intersectRect.js')};},webgl:require('./WebGL/webgl.js'),webglInputEvents:require('./WebGL/webglInputEvents.js'),generator:function(){return require('ngraph.generators');},Input:{domInputManager:require('./Input/domInputManager.js'),webglInputManager:require('./Input/webglInputManager.js')},Utils:{dragndrop:require('./Input/dragndrop.js'),findElementPosition:require('./Utils/findElementPosition.js'),timer:require('./Utils/timer.js'),getDimension:require('./Utils/getDimensions.js'),events:require('./Utils/backwardCompatibleEvents.js')},Layout:{forceDirected:require('ngraph.forcelayout'),constant:require('./Layout/constant.js')},View:{Texture:require('./WebGL/texture.js'),webglAtlas:require('./WebGL/webglAtlas.js'),webglImageNodeProgram:require('./WebGL/webglImageNodeProgram.js'),webglLinkProgram:require('./WebGL/webglLinkProgram.js'),webglNodeProgram:require('./WebGL/webglNodeProgram.js'),webglLine:require('./WebGL/webglLine.js'),webglSquare:require('./WebGL/webglSquare.js'),webglImage:require('./WebGL/webglImage.js'),webglchartViewics:require('./View/webglchartViewics.js'),_webglUtil:{parseColor:require('./WebGL/parseColor.js')},svgchartViewics:require('./View/svgchartViewics.js'),renderer:require('./View/renderer.js'),csschartViewics:function(){throw new Error('csschartViewics is deprecated. Please use older version of nokhbegraph (< 0.7) if you need it');},svgNodeFactory:function(){throw new Error('svgNodeFactory is deprecated. Please use older version of nokhbegraph (< 0.7) if you need it');},community:function(){throw new Error('community is deprecated. Please use nokhbegraph < 0.7 if you need it, or `https://github.com/anvaka/ngraph.slpa` module');}},Rect:require('./Utils/rect.js'),svg:require('simplesvg'),BrowserInfo:require('./Utils/browserInfo.js')};module.exports=nokhbe;},{"./Algorithms/centrality.js":32,"./Algorithms/operations.js":33,"./Input/domInputManager.js":34,"./Input/dragndrop.js":35,"./Input/webglInputManager.js":36,"./Layout/constant.js":37,"./Utils/backwardCompatibleEvents.js":38,"./Utils/browserInfo.js":39,"./Utils/findElementPosition.js":41,"./Utils/getDimensions.js":42,"./Utils/intersectRect.js":43,"./Utils/rect.js":45,"./Utils/timer.js":46,"./View/renderer.js":48,"./View/svgchartViewics.js":49,"./View/webglchartViewics.js":50,"./WebGL/parseColor.js":51,"./WebGL/texture.js":52,"./WebGL/webgl.js":53,"./WebGL/webglAtlas.js":54,"./WebGL/webglImage.js":55,"./WebGL/webglImageNodeProgram.js":56,"./WebGL/webglInputEvents.js":57,"./WebGL/webglLine.js":58,"./WebGL/webglLinkProgram.js":59,"./WebGL/webglNodeProgram.js":60,"./WebGL/webglSquare.js":61,"./version.js":62,"gintersect":3,"ngraph.events":7,"ngraph.forcelayout":9,"ngraph.fromjson":10,"ngraph.generators":11,"ngraph.graph":12,"ngraph.merge":13,"ngraph.random":26,"ngraph.tojson":27,"simplesvg":28}],2:[function(require,module,exports){addEventListener.removeEventListener=removeEventListener
addEventListener.addEventListener=addEventListener
module.exports=addEventListener
var Events=null
function addEventListener(el,eventName,listener,useCapture){Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach})
return Events.add(el,eventName,listener,useCapture)}
function removeEventListener(el,eventName,listener,useCapture){Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach})
return Events.rm(el,eventName,listener,useCapture)}
function stdAttach(el,eventName,listener,useCapture){el.addEventListener(eventName,listener,useCapture)}
function stdDetach(el,eventName,listener,useCapture){el.removeEventListener(eventName,listener,useCapture)}
function oldIEAttach(el,eventName,listener,useCapture){if(useCapture){throw new Error('cannot useCapture in oldIE')}
el.attachEvent('on'+eventName,listener)}
function oldIEDetach(el,eventName,listener,useCapture){el.detachEvent('on'+eventName,listener)}},{}],3:[function(require,module,exports){module.exports=intersect;function intersect(x1,y1,x2,y2,x3,y3,x4,y4){var a1,a2,b1,b2,c1,c2,r1,r2,r3,r4,denom,offset,num,result={x:0,y:0};a1=y2-y1;b1=x1-x2;c1=x2*y1-x1*y2;r3=a1*x3+b1*y3+c1;r4=a1*x4+b1*y4+c1;if(r3!==0&&r4!==0&&((r3>=0)===(r4>=4))){return null;}
a2=y4-y3;b2=x3-x4;c2=x4*y3-x3*y4;r1=a2*x1+b2*y1+c2;r2=a2*x2+b2*y2+c2;if(r1!==0&&r2!==0&&((r1>=0)===(r2>=0))){return null;}
denom=a1*b2-a2*b1;if(denom===0){return null;}
offset=denom<0?-denom / 2:denom / 2;offset=0.0;num=b1*c2-b2*c1;result.x=(num<0?num-offset:num+offset)/ denom;num=a2*c1-a1*c2;result.y=(num<0?num-offset:num+offset)/ denom;return result;}},{}],4:[function(require,module,exports){module.exports.degree=require('./src/degree.js');module.exports.betweenness=require('./src/betweenness.js');},{"./src/betweenness.js":5,"./src/degree.js":6}],5:[function(require,module,exports){module.exports=betweennes;function betweennes(graph,oriented){var Q=[],S=[];var pred=Object.create(null);var dist=Object.create(null);var sigma=Object.create(null);var delta=Object.create(null);var currentNode;var centrality=Object.create(null);graph.forEachNode(setCentralityToZero);graph.forEachNode(calculateCentrality);if(!oriented){Object.keys(centrality).forEach(divideByTwo);}
return centrality;function divideByTwo(key){centrality[key]/=2;}
function setCentralityToZero(node){centrality[node.id]=0;}
function calculateCentrality(node){currentNode=node.id;singleSourceShortestPath(currentNode);accumulate();}
function accumulate(){graph.forEachNode(setDeltaToZero);while(S.length){var w=S.pop();var coeff=(1+delta[w])/ sigma[w];var predcessors=pred[w];for(var idx=0;idx<predcessors.length;++idx){var v=predcessors[idx];delta[v]+=sigma[v]*coeff;}
if(w!==currentNode){centrality[w]+=delta[w];}}}
function setDeltaToZero(node){delta[node.id]=0;}
function singleSourceShortestPath(source){graph.forEachNode(initNode);dist[source]=0;sigma[source]=1;Q.push(source);while(Q.length){var v=Q.shift();var dedup=Object.create(null);S.push(v);graph.forEachLinkedNode(v,toId,oriented);}
function toId(otherNode){processNode(otherNode.id);}
function initNode(node){var nodeId=node.id;pred[nodeId]=[];dist[nodeId]=-1;sigma[nodeId]=0;}
function processNode(w){if(dist[w]===-1){dist[w]=dist[v]+1;Q.push(w);}
if(dist[w]===dist[v]+1){sigma[w]+=sigma[v];pred[w].push(v);}}}}},{}],6:[function(require,module,exports){module.exports=degree;function degree(graph,kind){var getNodeDegree,sortedDegrees=[],result=Object.create(null),nodeDegree;kind=(kind||'both').toLowerCase();if(kind==='both'||kind==='inout'){getNodeDegree=inoutDegreeCalculator;}else if(kind==='in'){getNodeDegree=inDegreeCalculator;}else if(kind==='out'){getNodeDegree=outDegreeCalculator;}else{throw new Error('Expected centrality degree kind is: in, out or both');}
graph.forEachNode(calculateNodeDegree);return result;function calculateNodeDegree(node){var links=graph.getLinks(node.id);result[node.id]=getNodeDegree(links,node.id);}}
function inDegreeCalculator(links,nodeId){var total=0;for(var i=0;i<links.length;i+=1){total+=(links[i].toId===nodeId)?1:0;}
return total;}
function outDegreeCalculator(links,nodeId){var total=0;for(var i=0;i<links.length;i+=1){total+=(links[i].fromId===nodeId)?1:0;}
return total;}
function inoutDegreeCalculator(links){return links.length;}},{}],7:[function(require,module,exports){module.exports=function(subject){validateSubject(subject);var eventsStorage=createEventsStorage(subject);subject.on=eventsStorage.on;subject.off=eventsStorage.off;subject.fire=eventsStorage.fire;return subject;};function createEventsStorage(subject){var registeredEvents=Object.create(null);return{on:function(eventName,callback,ctx){if(typeof callback!=='function'){throw new Error('callback is expected to be a function');}
var handlers=registeredEvents[eventName];if(!handlers){handlers=registeredEvents[eventName]=[];}
handlers.push({callback:callback,ctx:ctx});return subject;},off:function(eventName,callback){var wantToRemoveAll=(typeof eventName==='undefined');if(wantToRemoveAll){registeredEvents=Object.create(null);return subject;}
if(registeredEvents[eventName]){var deleteAllCallbacksForEvent=(typeof callback!=='function');if(deleteAllCallbacksForEvent){delete registeredEvents[eventName];}else{var callbacks=registeredEvents[eventName];for(var i=0;i<callbacks.length;++i){if(callbacks[i].callback===callback){callbacks.splice(i,1);}}}}
return subject;},fire:function(eventName){var callbacks=registeredEvents[eventName];if(!callbacks){return subject;}
var fireArguments;if(arguments.length>1){fireArguments=Array.prototype.splice.call(arguments,1);}
for(var i=0;i<callbacks.length;++i){var callbackInfo=callbacks[i];callbackInfo.callback.apply(callbackInfo.ctx,fireArguments);}
return subject;}};}
function validateSubject(subject){if(!subject){throw new Error('Eventify cannot use falsy object as events subject');}
var reservedWords=['on','fire','off'];for(var i=0;i<reservedWords.length;++i){if(subject.hasOwnProperty(reservedWords[i])){throw new Error("Subject cannot be eventified, since it already has property '"+reservedWords[i]+"'");}}}},{}],8:[function(require,module,exports){module.exports=exposeProperties;function exposeProperties(settings,target,filter){var needsFilter=Object.prototype.toString.call(filter)==='[object Array]';if(needsFilter){for(var i=0;i<filter.length;++i){augment(settings,target,filter[i]);}}else{for(var key in settings){augment(settings,target,key);}}}
function augment(source,target,key){if(source.hasOwnProperty(key)){if(typeof target[key]==='function'){return;}
target[key]=function(value){if(value!==undefined){source[key]=value;return target;}
return source[key];}}}},{}],9:[function(require,module,exports){module.exports=createLayout;module.exports.simulator=require('ngraph.physics.simulator');var eventify=require('ngraph.events');function createLayout(graph,physicsSettings){if(!graph){throw new Error('chartView structure cannot be undefined');}
var createSimulator=require('ngraph.physics.simulator');var physicsSimulator=createSimulator(physicsSettings);var nodeBodies=Object.create(null);var springs={};var bodiesCount=0;var springTransform=physicsSimulator.settings.springTransform||noop;initPhysics();listenToEvents();var wasStable=false;var api={step:function(){if(bodiesCount===0)return true;var lastMove=physicsSimulator.step();api.lastMove=lastMove;api.fire('step');var ratio=lastMove / bodiesCount;var isStableNow=ratio<=0.01;if(wasStable!==isStableNow){wasStable=isStableNow;onStableChanged(isStableNow);}
return isStableNow;},getNodePosition:function(nodeId){return getInitializedBody(nodeId).pos;},setNodePosition:function(nodeId){var body=getInitializedBody(nodeId);body.setPosition.apply(body,Array.prototype.slice.call(arguments,1));},getLinkPosition:function(linkId){var spring=springs[linkId];if(spring){return{from:spring.from.pos,to:spring.to.pos};}},getchartViewRect:function(){return physicsSimulator.getBBox();},forEachBody:forEachBody,pinNode:function(node,isPinned){var body=getInitializedBody(node.id);body.isPinned=!!isPinned;},isNodePinned:function(node){return getInitializedBody(node.id).isPinned;},dispose:function(){graph.off('changed',onchartViewChanged);api.fire('disposed');},getBody:getBody,getSpring:getSpring,simulator:physicsSimulator,graph:graph,lastMove:0};eventify(api);return api;function forEachBody(cb){Object.keys(nodeBodies).forEach(function(bodyId){cb(nodeBodies[bodyId],bodyId);});}
function getSpring(fromId,toId){var linkId;if(toId===undefined){if(typeof fromId!=='object'){linkId=fromId;}else{linkId=fromId.id;}}else{var link=graph.hasLink(fromId,toId);if(!link)return;linkId=link.id;}
return springs[linkId];}
function getBody(nodeId){return nodeBodies[nodeId];}
function listenToEvents(){graph.on('changed',onchartViewChanged);}
function onStableChanged(isStable){api.fire('stable',isStable);}
function onchartViewChanged(changes){for(var i=0;i<changes.length;++i){var change=changes[i];if(change.changeType==='add'){if(change.node){initBody(change.node.id);}
if(change.link){initLink(change.link);}}else if(change.changeType==='remove'){if(change.node){releaseNode(change.node);}
if(change.link){releaseLink(change.link);}}}
bodiesCount=graph.getNodesCount();}
function initPhysics(){bodiesCount=0;graph.forEachNode(function(node){initBody(node.id);bodiesCount+=1;});graph.forEachLink(initLink);}
function initBody(nodeId){var body=nodeBodies[nodeId];if(!body){var node=graph.getNode(nodeId);if(!node){throw new Error('initBody() was called with unknown node id');}
var pos=node.position;if(!pos){var neighbors=getNeighborBodies(node);pos=physicsSimulator.getBestNewBodyPosition(neighbors);}
body=physicsSimulator.addBodyAt(pos);body.id=nodeId;nodeBodies[nodeId]=body;updateBodyMass(nodeId);if(isNodeOriginallyPinned(node)){body.isPinned=true;}}}
function releaseNode(node){var nodeId=node.id;var body=nodeBodies[nodeId];if(body){nodeBodies[nodeId]=null;delete nodeBodies[nodeId];physicsSimulator.removeBody(body);}}
function initLink(link){updateBodyMass(link.fromId);updateBodyMass(link.toId);var fromBody=nodeBodies[link.fromId],toBody=nodeBodies[link.toId],spring=physicsSimulator.addSpring(fromBody,toBody,link.length);springTransform(link,spring);springs[link.id]=spring;}
function releaseLink(link){var spring=springs[link.id];if(spring){var from=graph.getNode(link.fromId),to=graph.getNode(link.toId);if(from)updateBodyMass(from.id);if(to)updateBodyMass(to.id);delete springs[link.id];physicsSimulator.removeSpring(spring);}}
function getNeighborBodies(node){var neighbors=[];if(!node.links){return neighbors;}
var maxNeighbors=Math.min(node.links.length,2);for(var i=0;i<maxNeighbors;++i){var link=node.links[i];var otherBody=link.fromId!==node.id?nodeBodies[link.fromId]:nodeBodies[link.toId];if(otherBody&&otherBody.pos){neighbors.push(otherBody);}}
return neighbors;}
function updateBodyMass(nodeId){var body=nodeBodies[nodeId];body.mass=nodeMass(nodeId);}
function isNodeOriginallyPinned(node){return(node&&(node.isPinned||(node.data&&node.data.isPinned)));}
function getInitializedBody(nodeId){var body=nodeBodies[nodeId];if(!body){initBody(nodeId);body=nodeBodies[nodeId];}
return body;}
function nodeMass(nodeId){var links=graph.getLinks(nodeId);if(!links)return 1;return 1+links.length / 3.0;}}
function noop(){}},{"ngraph.events":7,"ngraph.physics.simulator":15}],10:[function(require,module,exports){module.exports=load;var createchartView=require('ngraph.graph');function load(jsonchartView,nodeTransform,linkTransform){var stored;nodeTransform=nodeTransform||id;linkTransform=linkTransform||id;if(typeof jsonchartView==='string'){stored=JSON.parse(jsonchartView);}else{stored=jsonchartView;}
var graph=createchartView(),i;if(stored.links===undefined||stored.nodes===undefined){throw new Error('Cannot load graph without links and nodes');}
for(i=0;i<stored.nodes.length;++i){var parsedNode=nodeTransform(stored.nodes[i]);if(!parsedNode.hasOwnProperty('id')){throw new Error('chartView node format is invalid: Node id is missing');}
graph.addNode(parsedNode.id,parsedNode.data);}
for(i=0;i<stored.links.length;++i){var link=linkTransform(stored.links[i]);if(!link.hasOwnProperty('fromId')||!link.hasOwnProperty('toId')){throw new Error('chartView link format is invalid. Both fromId and toId are required');}
graph.addLink(link.fromId,link.toId,link.data);}
return graph;}
function id(x){return x;}},{"ngraph.graph":12}],11:[function(require,module,exports){module.exports={ladder:ladder,complete:complete,completeBipartite:completeBipartite,balancedBinTree:balancedBinTree,path:path,circularLadder:circularLadder,grid:grid,grid3:grid3,noLinks:noLinks,wattsStrogatz:wattsStrogatz};var createchartView=require('ngraph.graph');function ladder(n){if(!n||n<0){throw new Error("Invalid number of nodes");}
var g=createchartView(),i;for(i=0;i<n-1;++i){g.addLink(i,i+1);g.addLink(n+i,n+i+1);g.addLink(i,n+i);}
g.addLink(n-1,2*n-1);return g;}
function circularLadder(n){if(!n||n<0){throw new Error("Invalid number of nodes");}
var g=ladder(n);g.addLink(0,n-1);g.addLink(n,2*n-1);return g;}
function complete(n){if(!n||n<1){throw new Error("At least two nodes are expected for complete graph");}
var g=createchartView(),i,j;for(i=0;i<n;++i){for(j=i+1;j<n;++j){if(i!==j){g.addLink(i,j);}}}
return g;}
function completeBipartite(n,m){if(!n||!m||n<0||m<0){throw new Error("chartView dimensions are invalid. Number of nodes in each partition should be greater than 0");}
var g=createchartView(),i,j;for(i=0;i<n;++i){for(j=n;j<n+m;++j){g.addLink(i,j);}}
return g;}
function path(n){if(!n||n<0){throw new Error("Invalid number of nodes");}
var g=createchartView(),i;g.addNode(0);for(i=1;i<n;++i){g.addLink(i-1,i);}
return g;}
function grid(n,m){if(n<1||m<1){throw new Error("Invalid number of nodes in grid graph");}
var g=createchartView(),i,j;if(n===1&&m===1){g.addNode(0);return g;}
for(i=0;i<n;++i){for(j=0;j<m;++j){var node=i+j*n;if(i>0){g.addLink(node,i-1+j*n);}
if(j>0){g.addLink(node,i+(j-1)*n);}}}
return g;}
function grid3(n,m,z){if(n<1||m<1||z<1){throw new Error("Invalid number of nodes in grid3 graph");}
var g=createchartView(),i,j,k;if(n===1&&m===1&&z===1){g.addNode(0);return g;}
for(k=0;k<z;++k){for(i=0;i<n;++i){for(j=0;j<m;++j){var level=k*n*m;var node=i+j*n+level;if(i>0){g.addLink(node,i-1+j*n+level);}
if(j>0){g.addLink(node,i+(j-1)*n+level);}
if(k>0){g.addLink(node,i+j*n+(k-1)*n*m);}}}}
return g;}
function balancedBinTree(n){if(n<0){throw new Error("Invalid number of nodes in balanced tree");}
var g=createchartView(),count=Math.pow(2,n),level;if(n===0){g.addNode(1);}
for(level=1;level<count;++level){var root=level,left=root*2,right=root*2+1;g.addLink(root,left);g.addLink(root,right);}
return g;}
function noLinks(n){if(n<0){throw new Error("Number of nodes shoul be >= 0");}
var g=createchartView(),i;for(i=0;i<n;++i){g.addNode(i);}
return g;}
function wattsStrogatz(n,k,p,seed){if(k>=n)throw new Error('Choose smaller `k`. It cannot be larger than number of nodes `n`');var random=require('ngraph.random').random(seed||42);var g=createchartView(),i,to;for(i=0;i<n;++i){g.addNode(i);}
var neighborsSize=Math.floor(k / 2+1);for(var j=1;j<neighborsSize;++j){for(i=0;i<n;++i){to=(j+i)%n;g.addLink(i,to);}}
for(j=1;j<neighborsSize;++j){for(i=0;i<n;++i){if(random.nextDouble()<p){var from=i;to=(j+i)%n;var newTo=random.next(n);var needsRewire=(newTo===from||g.hasLink(from,newTo));if(needsRewire&&g.getLinks(from).length===n-1){continue;}
while(needsRewire){newTo=random.next(n);needsRewire=(newTo===from||g.hasLink(from,newTo));}
var link=g.hasLink(from,to);g.removeLink(link);g.addLink(from,newTo);}}}
return g;}},{"ngraph.graph":12,"ngraph.random":26}],12:[function(require,module,exports){module.exports=createchartView;var eventify=require('ngraph.events');function createchartView(options){options=options||{};if(options.uniqueLinkId===undefined){options.uniqueLinkId=true;}
var nodes=typeof Object.create==='function'?Object.create(null):{},links=[],multiEdges={},nodesCount=0,suspendEvents=0,forEachNode=createNodeIterator(),createLink=options.uniqueLinkId?createUniqueLink:createSingleLink,changes=[],recordLinkChange=noop,recordNodeChange=noop,enterModification=noop,exitModification=noop;var graphPart={addNode:addNode,addLink:addLink,removeLink:removeLink,removeNode:removeNode,getNode:getNode,getNodesCount:function(){return nodesCount;},getLinksCount:function(){return links.length;},getLinks:getLinks,forEachNode:forEachNode,forEachLinkedNode:forEachLinkedNode,forEachLink:forEachLink,beginUpdate:enterModification,endUpdate:exitModification,clear:clear,hasLink:getLink,getLink:getLink};eventify(graphPart);monitorSubscribers();return graphPart;function monitorSubscribers(){var realOn=graphPart.on;graphPart.on=on;function on(){graphPart.beginUpdate=enterModification=enterModificationReal;graphPart.endUpdate=exitModification=exitModificationReal;recordLinkChange=recordLinkChangeReal;recordNodeChange=recordNodeChangeReal;graphPart.on=realOn;return realOn.apply(graphPart,arguments);}}
function recordLinkChangeReal(link,changeType){changes.push({link:link,changeType:changeType});}
function recordNodeChangeReal(node,changeType){changes.push({node:node,changeType:changeType});}
function addNode(nodeId,data){if(nodeId===undefined){throw new Error('Invalid node identifier');}
enterModification();var node=getNode(nodeId);if(!node){node=new Node(nodeId);nodesCount++;recordNodeChange(node,'add');}else{recordNodeChange(node,'update');}
node.data=data;nodes[nodeId]=node;exitModification();return node;}
function getNode(nodeId){return nodes[nodeId];}
function removeNode(nodeId){var node=getNode(nodeId);if(!node){return false;}
enterModification();while(node.links.length){var link=node.links[0];removeLink(link);}
delete nodes[nodeId];nodesCount--;recordNodeChange(node,'remove');exitModification();return true;}
function addLink(fromId,toId,data){enterModification();var fromNode=getNode(fromId)||addNode(fromId);var toNode=getNode(toId)||addNode(toId);var link=createLink(fromId,toId,data);links.push(link);fromNode.links.push(link);if(fromId!==toId){toNode.links.push(link);}
recordLinkChange(link,'add');exitModification();return link;}
function createSingleLink(fromId,toId,data){var linkId=fromId.toString()+toId.toString();return new Link(fromId,toId,data,linkId);}
function createUniqueLink(fromId,toId,data){var linkId=fromId.toString()+'👉 '+toId.toString();var isMultiEdge=multiEdges.hasOwnProperty(linkId);if(isMultiEdge||getLink(fromId,toId)){if(!isMultiEdge){multiEdges[linkId]=0;}
linkId+='@'+(++multiEdges[linkId]);}
return new Link(fromId,toId,data,linkId);}
function getLinks(nodeId){var node=getNode(nodeId);return node?node.links:null;}
function removeLink(link){if(!link){return false;}
var idx=indexOfElementInArray(link,links);if(idx<0){return false;}
enterModification();links.splice(idx,1);var fromNode=getNode(link.fromId);var toNode=getNode(link.toId);if(fromNode){idx=indexOfElementInArray(link,fromNode.links);if(idx>=0){fromNode.links.splice(idx,1);}}
if(toNode){idx=indexOfElementInArray(link,toNode.links);if(idx>=0){toNode.links.splice(idx,1);}}
recordLinkChange(link,'remove');exitModification();return true;}
function getLink(fromNodeId,toNodeId){var node=getNode(fromNodeId),i;if(!node){return null;}
for(i=0;i<node.links.length;++i){var link=node.links[i];if(link.fromId===fromNodeId&&link.toId===toNodeId){return link;}}
return null;}
function clear(){enterModification();forEachNode(function(node){removeNode(node.id);});exitModification();}
function forEachLink(callback){var i,length;if(typeof callback==='function'){for(i=0,length=links.length;i<length;++i){callback(links[i]);}}}
function forEachLinkedNode(nodeId,callback,oriented){var node=getNode(nodeId);if(node&&node.links&&typeof callback==='function'){if(oriented){return forEachOrientedLink(node.links,nodeId,callback);}else{return forEachNonOrientedLink(node.links,nodeId,callback);}}}
function forEachNonOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];var linkedNodeId=link.fromId===nodeId?link.toId:link.fromId;quitFast=callback(nodes[linkedNodeId],link);if(quitFast){return true;}}}
function forEachOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];if(link.fromId===nodeId){quitFast=callback(nodes[link.toId],link);if(quitFast){return true;}}}}
function noop(){}
function enterModificationReal(){suspendEvents+=1;}
function exitModificationReal(){suspendEvents-=1;if(suspendEvents===0&&changes.length>0){graphPart.fire('changed',changes);changes.length=0;}}
function createNodeIterator(){return Object.keys?objectKeysIterator:forInIterator;}
function objectKeysIterator(callback){if(typeof callback!=='function'){return;}
var keys=Object.keys(nodes);for(var i=0;i<keys.length;++i){if(callback(nodes[keys[i]])){return true;}}}
function forInIterator(callback){if(typeof callback!=='function'){return;}
var node;for(node in nodes){if(callback(nodes[node])){return true;}}}}
function indexOfElementInArray(element,array){if(array.indexOf){return array.indexOf(element);}
var len=array.length,i;for(i=0;i<len;i+=1){if(array[i]===element){return i;}}
return-1;}
function Node(id){this.id=id;this.links=[];this.data=null;}
function Link(fromId,toId,data,id){this.fromId=fromId;this.toId=toId;this.data=data;this.id=id;}},{"ngraph.events":7}],13:[function(require,module,exports){module.exports=merge;function merge(target,options){var key;if(!target){target={};}
if(options){for(key in options){if(options.hasOwnProperty(key)){var targetHasIt=target.hasOwnProperty(key),optionsValueType=typeof options[key],shouldReplace=!targetHasIt||(typeof target[key]!==optionsValueType);if(shouldReplace){target[key]=options[key];}else if(optionsValueType==='object'){target[key]=merge(target[key],options[key]);}}}}
return target;}},{}],14:[function(require,module,exports){module.exports={Body:Body,Vector2d:Vector2d,Body3d:Body3d,Vector3d:Vector3d};function Body(x,y){this.pos=new Vector2d(x,y);this.prevPos=new Vector2d(x,y);this.force=new Vector2d();this.velocity=new Vector2d();this.mass=1;}
Body.prototype.setPosition=function(x,y){this.prevPos.x=this.pos.x=x;this.prevPos.y=this.pos.y=y;};function Vector2d(x,y){if(x&&typeof x!=='number'){this.x=typeof x.x==='number'?x.x:0;this.y=typeof x.y==='number'?x.y:0;}else{this.x=typeof x==='number'?x:0;this.y=typeof y==='number'?y:0;}}
Vector2d.prototype.reset=function(){this.x=this.y=0;};function Body3d(x,y,z){this.pos=new Vector3d(x,y,z);this.prevPos=new Vector3d(x,y,z);this.force=new Vector3d();this.velocity=new Vector3d();this.mass=1;}
Body3d.prototype.setPosition=function(x,y,z){this.prevPos.x=this.pos.x=x;this.prevPos.y=this.pos.y=y;this.prevPos.z=this.pos.z=z;};function Vector3d(x,y,z){if(x&&typeof x!=='number'){this.x=typeof x.x==='number'?x.x:0;this.y=typeof x.y==='number'?x.y:0;this.z=typeof x.z==='number'?x.z:0;}else{this.x=typeof x==='number'?x:0;this.y=typeof y==='number'?y:0;this.z=typeof z==='number'?z:0;}};Vector3d.prototype.reset=function(){this.x=this.y=this.z=0;};},{}],15:[function(require,module,exports){module.exports=physicsSimulator;function physicsSimulator(settings){var Spring=require('./lib/spring');var expose=require('ngraph.expose');var merge=require('ngraph.merge');var eventify=require('ngraph.events');settings=merge(settings,{springLength:30,springCoeff:0.0008,gravity:-1.2,theta:0.8,dragCoeff:0.02,timeStep:20,});var createQuadTree=settings.createQuadTree||require('ngraph.quadtreebh');var createBounds=settings.createBounds||require('./lib/bounds');var createDragForce=settings.createDragForce||require('./lib/dragForce');var createSpringForce=settings.createSpringForce||require('./lib/springForce');var integrate=settings.integrator||require('./lib/eulerIntegrator');var createBody=settings.createBody||require('./lib/createBody');var bodies=[],springs=[],quadTree=createQuadTree(settings),bounds=createBounds(bodies,settings),springForce=createSpringForce(settings),dragForce=createDragForce(settings);var totalMovement=0;var publicApi={bodies:bodies,quadTree:quadTree,springs:springs,settings:settings,step:function(){accumulateForces();var movement=integrate(bodies,settings.timeStep);bounds.update();return movement;},addBody:function(body){if(!body){throw new Error('Body is required');}
bodies.push(body);return body;},addBodyAt:function(pos){if(!pos){throw new Error('Body position is required');}
var body=createBody(pos);bodies.push(body);return body;},removeBody:function(body){if(!body){return;}
var idx=bodies.indexOf(body);if(idx<0){return;}
bodies.splice(idx,1);if(bodies.length===0){bounds.reset();}
return true;},addSpring:function(body1,body2,springLength,springWeight,springCoefficient){if(!body1||!body2){throw new Error('Cannot add null spring to force simulator');}
if(typeof springLength!=='number'){springLength=-1;}
var spring=new Spring(body1,body2,springLength,springCoefficient>=0?springCoefficient:-1,springWeight);springs.push(spring);return spring;},getTotalMovement:function(){return totalMovement;},removeSpring:function(spring){if(!spring){return;}
var idx=springs.indexOf(spring);if(idx>-1){springs.splice(idx,1);return true;}},getBestNewBodyPosition:function(neighbors){return bounds.getBestNewPosition(neighbors);},getBBox:function(){return bounds.box;},gravity:function(value){if(value!==undefined){settings.gravity=value;quadTree.options({gravity:value});return this;}else{return settings.gravity;}},theta:function(value){if(value!==undefined){settings.theta=value;quadTree.options({theta:value});return this;}else{return settings.theta;}}};expose(settings,publicApi);eventify(publicApi);return publicApi;function accumulateForces(){var body,i=bodies.length;if(i){quadTree.insertBodies(bodies);while(i--){body=bodies[i];if(!body.isPinned){body.force.reset();quadTree.updateBodyForce(body);dragForce.update(body);}}}
i=springs.length;while(i--){springForce.update(springs[i]);}}};},{"./lib/bounds":16,"./lib/createBody":17,"./lib/dragForce":18,"./lib/eulerIntegrator":19,"./lib/spring":20,"./lib/springForce":21,"ngraph.events":7,"ngraph.expose":8,"ngraph.merge":13,"ngraph.quadtreebh":22}],16:[function(require,module,exports){module.exports=function(bodies,settings){var random=require('ngraph.random').random(42);var boundingBox={x1:0,y1:0,x2:0,y2:0};return{box:boundingBox,update:updateBoundingBox,reset:function(){boundingBox.x1=boundingBox.y1=0;boundingBox.x2=boundingBox.y2=0;},getBestNewPosition:function(neighbors){var graphRect=boundingBox;var baseX=0,baseY=0;if(neighbors.length){for(var i=0;i<neighbors.length;++i){baseX+=neighbors[i].pos.x;baseY+=neighbors[i].pos.y;}
baseX /=neighbors.length;baseY /=neighbors.length;}else{baseX=(graphRect.x1+graphRect.x2)/ 2;baseY=(graphRect.y1+graphRect.y2)/ 2;}
var springLength=settings.springLength;return{x:baseX+random.next(springLength)-springLength / 2,y:baseY+random.next(springLength)-springLength / 2};}};function updateBoundingBox(){var i=bodies.length;if(i===0){return;}
var x1=Number.MAX_VALUE,y1=Number.MAX_VALUE,x2=Number.MIN_VALUE,y2=Number.MIN_VALUE;while(i--){var body=bodies[i];if(body.isPinned){body.pos.x=body.prevPos.x;body.pos.y=body.prevPos.y;}else{body.prevPos.x=body.pos.x;body.prevPos.y=body.pos.y;}
if(body.pos.x<x1){x1=body.pos.x;}
if(body.pos.x>x2){x2=body.pos.x;}
if(body.pos.y<y1){y1=body.pos.y;}
if(body.pos.y>y2){y2=body.pos.y;}}
boundingBox.x1=x1;boundingBox.x2=x2;boundingBox.y1=y1;boundingBox.y2=y2;}}},{"ngraph.random":26}],17:[function(require,module,exports){var physics=require('ngraph.physics.primitives');module.exports=function(pos){return new physics.Body(pos);}},{"ngraph.physics.primitives":14}],18:[function(require,module,exports){module.exports=function(options){var merge=require('ngraph.merge'),expose=require('ngraph.expose');options=merge(options,{dragCoeff:0.02});var api={update:function(body){body.force.x-=options.dragCoeff*body.velocity.x;body.force.y-=options.dragCoeff*body.velocity.y;}};expose(options,api,['dragCoeff']);return api;};},{"ngraph.expose":8,"ngraph.merge":13}],19:[function(require,module,exports){module.exports=integrate;function integrate(bodies,timeStep){var dx=0,tx=0,dy=0,ty=0,i,max=bodies.length;if(max===0){return 0;}
for(i=0;i<max;++i){var body=bodies[i],coeff=timeStep / body.mass;body.velocity.x+=coeff*body.force.x;body.velocity.y+=coeff*body.force.y;var vx=body.velocity.x,vy=body.velocity.y,v=Math.sqrt(vx*vx+vy*vy);if(v>1){body.velocity.x=vx / v;body.velocity.y=vy / v;}
dx=timeStep*body.velocity.x;dy=timeStep*body.velocity.y;body.pos.x+=dx;body.pos.y+=dy;tx+=Math.abs(dx);ty+=Math.abs(dy);}
return(tx*tx+ty*ty)/ max;}},{}],20:[function(require,module,exports){module.exports=Spring;function Spring(fromBody,toBody,length,coeff,weight){this.from=fromBody;this.to=toBody;this.length=length;this.coeff=coeff;this.weight=typeof weight==='number'?weight:1;};},{}],21:[function(require,module,exports){module.exports=function(options){var merge=require('ngraph.merge');var random=require('ngraph.random').random(42);var expose=require('ngraph.expose');options=merge(options,{springCoeff:0.0002,springLength:80});var api={update:function(spring){var body1=spring.from,body2=spring.to,length=spring.length<0?options.springLength:spring.length,dx=body2.pos.x-body1.pos.x,dy=body2.pos.y-body1.pos.y,r=Math.sqrt(dx*dx+dy*dy);if(r===0){dx=(random.nextDouble()-0.5)/ 50;dy=(random.nextDouble()-0.5)/ 50;r=Math.sqrt(dx*dx+dy*dy);}
var d=r-length;var coeff=((!spring.coeff||spring.coeff<0)?options.springCoeff:spring.coeff)*d / r*spring.weight;body1.force.x+=coeff*dx;body1.force.y+=coeff*dy;body2.force.x-=coeff*dx;body2.force.y-=coeff*dy;}};expose(options,api,['springCoeff','springLength']);return api;}},{"ngraph.expose":8,"ngraph.merge":13,"ngraph.random":26}],22:[function(require,module,exports){module.exports=function(options){options=options||{};options.gravity=typeof options.gravity==='number'?options.gravity:-1;options.theta=typeof options.theta==='number'?options.theta:0.8;var random=require('ngraph.random').random(1984),Node=require('./node'),InsertStack=require('./insertStack'),isSamePosition=require('./isSamePosition');var gravity=options.gravity,updateQueue=[],insertStack=new InsertStack(),theta=options.theta,nodesCache=[],currentInCache=0,root=newNode();return{insertBodies:insertBodies,getRoot:function(){return root;},updateBodyForce:update,options:function(newOptions){if(newOptions){if(typeof newOptions.gravity==='number'){gravity=newOptions.gravity;}
if(typeof newOptions.theta==='number'){theta=newOptions.theta;}
return this;}
return{gravity:gravity,theta:theta};}};function newNode(){var node=nodesCache[currentInCache];if(node){node.quad0=null;node.quad1=null;node.quad2=null;node.quad3=null;node.body=null;node.mass=node.massX=node.massY=0;node.left=node.right=node.top=node.bottom=0;}else{node=new Node();nodesCache[currentInCache]=node;}
++currentInCache;return node;}
function update(sourceBody){var queue=updateQueue,v,dx,dy,r,fx=0,fy=0,queueLength=1,shiftIdx=0,pushIdx=1;queue[0]=root;while(queueLength){var node=queue[shiftIdx],body=node.body;queueLength-=1;shiftIdx+=1;var differentBody=(body!==sourceBody);if(body&&differentBody){dx=body.pos.x-sourceBody.pos.x;dy=body.pos.y-sourceBody.pos.y;r=Math.sqrt(dx*dx+dy*dy);if(r===0){dx=(random.nextDouble()-0.5)/ 50;dy=(random.nextDouble()-0.5)/ 50;r=Math.sqrt(dx*dx+dy*dy);}
v=gravity*body.mass*sourceBody.mass /(r*r*r);fx+=v*dx;fy+=v*dy;}else if(differentBody){dx=node.massX / node.mass-sourceBody.pos.x;dy=node.massY / node.mass-sourceBody.pos.y;r=Math.sqrt(dx*dx+dy*dy);if(r===0){dx=(random.nextDouble()-0.5)/ 50;dy=(random.nextDouble()-0.5)/ 50;r=Math.sqrt(dx*dx+dy*dy);}
if((node.right-node.left)/ r<theta){v=gravity*node.mass*sourceBody.mass /(r*r*r);fx+=v*dx;fy+=v*dy;}else{if(node.quad0){queue[pushIdx]=node.quad0;queueLength+=1;pushIdx+=1;}
if(node.quad1){queue[pushIdx]=node.quad1;queueLength+=1;pushIdx+=1;}
if(node.quad2){queue[pushIdx]=node.quad2;queueLength+=1;pushIdx+=1;}
if(node.quad3){queue[pushIdx]=node.quad3;queueLength+=1;pushIdx+=1;}}}}
sourceBody.force.x+=fx;sourceBody.force.y+=fy;}
function insertBodies(bodies){var x1=Number.MAX_VALUE,y1=Number.MAX_VALUE,x2=Number.MIN_VALUE,y2=Number.MIN_VALUE,i,max=bodies.length;i=max;while(i--){var x=bodies[i].pos.x;var y=bodies[i].pos.y;if(x<x1){x1=x;}
if(x>x2){x2=x;}
if(y<y1){y1=y;}
if(y>y2){y2=y;}}
var dx=x2-x1,dy=y2-y1;if(dx>dy){y2=y1+dx;}else{x2=x1+dy;}
currentInCache=0;root=newNode();root.left=x1;root.right=x2;root.top=y1;root.bottom=y2;i=max-1;if(i>=0){root.body=bodies[i];}
while(i--){insert(bodies[i],root);}}
function insert(newBody){insertStack.reset();insertStack.push(root,newBody);while(!insertStack.isEmpty()){var stackItem=insertStack.pop(),node=stackItem.node,body=stackItem.body;if(!node.body){var x=body.pos.x;var y=body.pos.y;node.mass=node.mass+body.mass;node.massX=node.massX+body.mass*x;node.massY=node.massY+body.mass*y;var quadIdx=0,left=node.left,right=(node.right+left)/ 2,top=node.top,bottom=(node.bottom+top)/ 2;if(x>right){quadIdx=quadIdx+1;left=right;right=node.right;}
if(y>bottom){quadIdx=quadIdx+2;top=bottom;bottom=node.bottom;}
var child=getChild(node,quadIdx);if(!child){child=newNode();child.left=left;child.top=top;child.right=right;child.bottom=bottom;child.body=body;setChild(node,quadIdx,child);}else{insertStack.push(child,body);}}else{var oldBody=node.body;node.body=null;if(isSamePosition(oldBody.pos,body.pos)){var retriesCount=3;do{var offset=random.nextDouble();var dx=(node.right-node.left)*offset;var dy=(node.bottom-node.top)*offset;oldBody.pos.x=node.left+dx;oldBody.pos.y=node.top+dy;retriesCount-=1;}while(retriesCount>0&&isSamePosition(oldBody.pos,body.pos));if(retriesCount===0&&isSamePosition(oldBody.pos,body.pos)){return;}}
insertStack.push(node,oldBody);insertStack.push(node,body);}}}};function getChild(node,idx){if(idx===0)return node.quad0;if(idx===1)return node.quad1;if(idx===2)return node.quad2;if(idx===3)return node.quad3;return null;}
function setChild(node,idx,child){if(idx===0)node.quad0=child;else if(idx===1)node.quad1=child;else if(idx===2)node.quad2=child;else if(idx===3)node.quad3=child;}},{"./insertStack":23,"./isSamePosition":24,"./node":25,"ngraph.random":26}],23:[function(require,module,exports){module.exports=InsertStack;function InsertStack(){this.stack=[];this.popIdx=0;}
InsertStack.prototype={isEmpty:function(){return this.popIdx===0;},push:function(node,body){var item=this.stack[this.popIdx];if(!item){this.stack[this.popIdx]=new InsertStackElement(node,body);}else{item.node=node;item.body=body;}
++this.popIdx;},pop:function(){if(this.popIdx>0){return this.stack[--this.popIdx];}},reset:function(){this.popIdx=0;}};function InsertStackElement(node,body){this.node=node;this.body=body;}},{}],24:[function(require,module,exports){module.exports=function isSamePosition(point1,point2){var dx=Math.abs(point1.x-point2.x);var dy=Math.abs(point1.y-point2.y);return(dx<1e-8&&dy<1e-8);};},{}],25:[function(require,module,exports){module.exports=function Node(){this.body=null;this.quad0=null;this.quad1=null;this.quad2=null;this.quad3=null;this.mass=0;this.massX=0;this.massY=0;this.left=0;this.top=0;this.bottom=0;this.right=0;};},{}],26:[function(require,module,exports){module.exports={random:random,randomIterator:randomIterator};function random(inputSeed){var seed=typeof inputSeed==='number'?inputSeed:(+new Date());var randomFunc=function(){seed=((seed+0x7ed55d16)+(seed<<12))&0xffffffff;seed=((seed^0xc761c23c)^(seed>>>19))&0xffffffff;seed=((seed+0x165667b1)+(seed<<5))&0xffffffff;seed=((seed+0xd3a2646c)^(seed<<9))&0xffffffff;seed=((seed+0xfd7046c5)+(seed<<3))&0xffffffff;seed=((seed^0xb55a4f09)^(seed>>>16))&0xffffffff;return(seed&0xfffffff)/ 0x10000000;};return{next:function(maxValue){return Math.floor(randomFunc()*maxValue);},nextDouble:function(){return randomFunc();}};}
function randomIterator(array,customRandom){var localRandom=customRandom||random();if(typeof localRandom.next!=='function'){throw new Error('customRandom does not match expected API: next() function is missing');}
return{forEach:function(callback){var i,j,t;for(i=array.length-1;i>0;--i){j=localRandom.next(i+1);t=array[j];array[j]=array[i];array[i]=t;callback(t);}
if(array.length){callback(array[0]);}},shuffle:function(){var i,j,t;for(i=array.length-1;i>0;--i){j=localRandom.next(i+1);t=array[j];array[j]=array[i];array[i]=t;}
return array;}};}},{}],27:[function(require,module,exports){module.exports=save;function save(graph,customNodeTransform,customLinkTransform){var result={nodes:[],links:[]};var nodeTransform=customNodeTransform||defaultTransformForNode;var linkTransform=customLinkTransform||defaultTransformForLink;graph.forEachNode(saveNode);graph.forEachLink(saveLink);return JSON.stringify(result);function saveNode(node){result.nodes.push(nodeTransform(node));}
function saveLink(link){result.links.push(linkTransform(link));}
function defaultTransformForNode(node){var result={id:node.id};if(node.data!==undefined){result.data=node.data;}
return result;}
function defaultTransformForLink(link){var result={fromId:link.fromId,toId:link.toId,};if(link.data!==undefined){result.data=link.data;}
return result;}}},{}],28:[function(require,module,exports){module.exports=svg;svg.compile=require('./lib/compile');var compileTemplate=svg.compileTemplate=require('./lib/compile_template');var domEvents=require('add-event-listener');var svgns="http://www.w3.org/2000/svg";var xlinkns="http://www.w3.org/1999/xlink";function svg(element,attrBag){var svgElement=augment(element);if(attrBag===undefined){return svgElement;}
var attributes=Object.keys(attrBag);for(var i=0;i<attributes.length;++i){var attributeName=attributes[i];var value=attrBag[attributeName];if(attributeName==='link'){svgElement.link(value);}else{svgElement.attr(attributeName,value);}}
return svgElement;}
function augment(element){var svgElement=element;if(typeof element==="string"){svgElement=window.document.createElementNS(svgns,element);}else if(element.simplesvg){return element;}
var compiledTempalte;svgElement.simplesvg=true;svgElement.attr=attr;svgElement.append=append;svgElement.link=link;svgElement.text=text;svgElement.on=on;svgElement.off=off;svgElement.dataSource=dataSource;return svgElement;function dataSource(model){if(!compiledTempalte)compiledTempalte=compileTemplate(svgElement);compiledTempalte.link(model);return svgElement;}
function on(name,cb,useCapture){domEvents.addEventListener(svgElement,name,cb,useCapture);return svgElement;}
function off(name,cb,useCapture){domEvents.removeEventListener(svgElement,name,cb,useCapture);return svgElement;}
function append(content){var child=svg(content);svgElement.appendChild(child);return child;}
function attr(name,value){if(arguments.length===2){if(value!==null){svgElement.setAttributeNS(null,name,value);}else{svgElement.removeAttributeNS(null,name);}
return svgElement;}
return svgElement.getAttributeNS(null,name);}
function link(target){if(arguments.length){svgElement.setAttributeNS(xlinkns,"xlink:href",target);return svgElement;}
return svgElement.getAttributeNS(xlinkns,"xlink:href");}
function text(textContent){if(textContent!==undefined){svgElement.textContent=textContent;return svgElement;}
return svgElement.textContent;}}},{"./lib/compile":29,"./lib/compile_template":30,"add-event-listener":2}],29:[function(require,module,exports){var parser=require('./domparser.js');var svg=require('../');module.exports=compile;function compile(svgText){try{svgText=addNamespaces(svgText);return svg(parser.parseFromString(svgText,"text/xml").documentElement);}catch(e){throw e;}}
function addNamespaces(text){if(!text)return;var namespaces='xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"';var match=text.match(/^<\w+/);if(match){var tagLength=match[0].length;return text.substr(0,tagLength)+' '+namespaces+' '+text.substr(tagLength);}else{throw new Error('Cannot parse input text: invalid xml?');}}},{"../":28,"./domparser.js":31}],30:[function(require,module,exports){module.exports=template;var BINDING_EXPR=/{{(.+?)}}/;function template(domNode){var allBindings=Object.create(null);extractAllBindings(domNode,allBindings);return{link:function(model){Object.keys(allBindings).forEach(function(key){var setter=allBindings[key];setter.forEach(changeModel);});function changeModel(setter){setter(model);}}};}
function extractAllBindings(domNode,allBindings){var nodeType=domNode.nodeType;var typeSupported=(nodeType===1)||(nodeType===3);if(!typeSupported)return;var i;if(domNode.hasChildNodes()){var domChildren=domNode.childNodes;for(i=0;i<domChildren.length;++i){extractAllBindings(domChildren[i],allBindings);}}
if(nodeType===3){bindTextContent(domNode,allBindings);}
if(!domNode.attributes)return;var attrs=domNode.attributes;for(i=0;i<attrs.length;++i){bindDomAttribute(attrs[i],domNode,allBindings);}}
function bindDomAttribute(domAttribute,element,allBindings){var value=domAttribute.value;if(!value)return;var modelNameMatch=value.match(BINDING_EXPR);if(!modelNameMatch)return;var attrName=domAttribute.localName;var modelPropertyName=modelNameMatch[1];var isSimpleValue=modelPropertyName.indexOf('.')<0;if(!isSimpleValue)throw new Error('simplesvg currently does not support nested bindings');var propertyBindings=allBindings[modelPropertyName];if(!propertyBindings){propertyBindings=allBindings[modelPropertyName]=[attributeSetter];}else{propertyBindings.push(attributeSetter);}
function attributeSetter(model){element.setAttributeNS(null,attrName,model[modelPropertyName]);}}
function bindTextContent(element,allBindings){var value=element.nodeValue;if(!value)return;var modelNameMatch=value.match(BINDING_EXPR);if(!modelNameMatch)return;var modelPropertyName=modelNameMatch[1];var isSimpleValue=modelPropertyName.indexOf('.')<0;var propertyBindings=allBindings[modelPropertyName];if(!propertyBindings){propertyBindings=allBindings[modelPropertyName]=[textSetter];}else{propertyBindings.push(textSetter);}
function textSetter(model){element.nodeValue=model[modelPropertyName];}}},{}],31:[function(require,module,exports){module.exports=createDomparser();function createDomparser(){if(typeof DOMParser==='undefined'){return{parseFromString:fail};}
return new DOMParser();}
function fail(){throw new Error('DOMParser is not supported by this platform. Please open issue here https://github.com/anvaka/simplesvg');}},{}],32:[function(require,module,exports){var centrality=require('ngraph.centrality');module.exports=centralityWrapper;function centralityWrapper(){return{betweennessCentrality:betweennessCentrality,degreeCentrality:degreeCentrality};}
function betweennessCentrality(g){var betweenness=centrality.betweenness(g);return tonokhbechartViewCentralityFormat(betweenness);}
function degreeCentrality(g,kind){var degree=centrality.degree(g,kind);return tonokhbechartViewCentralityFormat(degree);}
function tonokhbechartViewCentralityFormat(centrality){return Object.keys(centrality).sort(byValue).map(toKeyValue);function byValue(x,y){return centrality[y]-centrality[x];}
function toKeyValue(key){return{key:key,value:centrality[key]};}}},{"ngraph.centrality":4}],33:[function(require,module,exports){module.exports=operations;function operations(){return{density:function(graph,directed){var nodes=graph.getNodesCount();if(nodes===0){return NaN;}
if(directed){return graph.getLinksCount()/(nodes*(nodes-1));}else{return 2*graph.getLinksCount()/(nodes*(nodes-1));}}};};},{}],34:[function(require,module,exports){module.exports=domInputManager;var dragndrop=require('./dragndrop.js');function domInputManager(graph,graphics){var nodeEvents={};return{bindDragNDrop:bindDragNDrop};function bindDragNDrop(node,handlers){var events;if(handlers){var nodeUI=graphics.getNodeUI(node.id);events=dragndrop(nodeUI);if(typeof handlers.onStart==='function'){events.onStart(handlers.onStart);}
if(typeof handlers.onDrag==='function'){events.onDrag(handlers.onDrag);}
if(typeof handlers.onStop==='function'){events.onStop(handlers.onStop);}
nodeEvents[node.id]=events;}else if((events=nodeEvents[node.id])){events.release();delete nodeEvents[node.id];}}}},{"./dragndrop.js":35}],35:[function(require,module,exports){module.exports=dragndrop;var documentEvents=require('../Utils/documentEvents.js');var browserInfo=require('../Utils/browserInfo.js');var findElementPosition=require('../Utils/findElementPosition.js');function dragndrop(element){var start,drag,end,scroll,prevSelectStart,prevDragStart,startX=0,startY=0,dragObject,touchInProgress=false,pinchZoomLength=0,getMousePos=function(e){var posx=0,posy=0;e=e||window.event;if(e.pageX||e.pageY){posx=e.pageX;posy=e.pageY;}else if(e.clientX||e.clientY){posx=e.clientX+window.document.body.scrollLeft+window.document.documentElement.scrollLeft;posy=e.clientY+window.document.body.scrollTop+window.document.documentElement.scrollTop;}
return[posx,posy];},move=function(e,clientX,clientY){if(drag){drag(e,{x:clientX-startX,y:clientY-startY});}
startX=clientX;startY=clientY;},stopPropagation=function(e){if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;}},preventDefault=function(e){if(e.preventDefault){e.preventDefault();}},handleDisabledEvent=function(e){stopPropagation(e);return false;},handleMouseMove=function(e){e=e||window.event;move(e,e.clientX,e.clientY);},handleMouseDown=function(e){e=e||window.event;if(touchInProgress){stopPropagation(e);return false;}
var isLeftButton=((e.button===1&&window.event!==null)||e.button===0);if(isLeftButton){startX=e.clientX;startY=e.clientY;dragObject=e.target||e.srcElement;if(start){start(e,{x:startX,y:startY});}
documentEvents.on('mousemove',handleMouseMove);documentEvents.on('mouseup',handleMouseUp);stopPropagation(e);prevSelectStart=window.document.onselectstart;prevDragStart=window.document.ondragstart;window.document.onselectstart=handleDisabledEvent;dragObject.ondragstart=handleDisabledEvent;return false;}},handleMouseUp=function(e){e=e||window.event;documentEvents.off('mousemove',handleMouseMove);documentEvents.off('mouseup',handleMouseUp);window.document.onselectstart=prevSelectStart;dragObject.ondragstart=prevDragStart;dragObject=null;},handleMouseWheel=function(e){if(typeof scroll!=='function'){return;}
e=e||window.event;if(e.preventDefault){e.preventDefault();}
e.returnValue=false;var delta,mousePos=getMousePos(e),elementOffset=findElementPosition(element),relMousePos={x:mousePos[0]-elementOffset[0],y:mousePos[1]-elementOffset[1]};if(e.wheelDelta){delta=e.wheelDelta / 360;}else{delta=e.detail /-9;}
scroll(e,delta,relMousePos);},updateScrollEvents=function(scrollCallback){if(!scroll&&scrollCallback){if(browserInfo.browser==='webkit'){element.addEventListener('mousewheel',handleMouseWheel,false);}else{element.addEventListener('DOMMouseScroll',handleMouseWheel,false);}}else if(scroll&&!scrollCallback){if(browserInfo.browser==='webkit'){element.removeEventListener('mousewheel',handleMouseWheel,false);}else{element.removeEventListener('DOMMouseScroll',handleMouseWheel,false);}}
scroll=scrollCallback;},getPinchZoomLength=function(finger1,finger2){return(finger1.clientX-finger2.clientX)*(finger1.clientX-finger2.clientX)+
(finger1.clientY-finger2.clientY)*(finger1.clientY-finger2.clientY);},handleTouchMove=function(e){if(e.touches.length===1){stopPropagation(e);var touch=e.touches[0];move(e,touch.clientX,touch.clientY);}else if(e.touches.length===2){var currentPinchLength=getPinchZoomLength(e.touches[0],e.touches[1]);var delta=0;if(currentPinchLength<pinchZoomLength){delta=-1;}else if(currentPinchLength>pinchZoomLength){delta=1;}
scroll(e,delta,{x:e.touches[0].clientX,y:e.touches[0].clientY});pinchZoomLength=currentPinchLength;stopPropagation(e);preventDefault(e);}},handleTouchEnd=function(e){touchInProgress=false;documentEvents.off('touchmove',handleTouchMove);documentEvents.off('touchend',handleTouchEnd);documentEvents.off('touchcancel',handleTouchEnd);dragObject=null;if(end){end(e);}},handleSignleFingerTouch=function(e,touch){stopPropagation(e);preventDefault(e);startX=touch.clientX;startY=touch.clientY;dragObject=e.target||e.srcElement;if(start){start(e,{x:startX,y:startY});}
if(!touchInProgress){touchInProgress=true;documentEvents.on('touchmove',handleTouchMove);documentEvents.on('touchend',handleTouchEnd);documentEvents.on('touchcancel',handleTouchEnd);}},handleTouchStart=function(e){if(e.touches.length===1){return handleSignleFingerTouch(e,e.touches[0]);}else if(e.touches.length===2){stopPropagation(e);preventDefault(e);pinchZoomLength=getPinchZoomLength(e.touches[0],e.touches[1]);}};element.addEventListener('mousedown',handleMouseDown);element.addEventListener('touchstart',handleTouchStart);return{onStart:function(callback){start=callback;return this;},onDrag:function(callback){drag=callback;return this;},onStop:function(callback){end=callback;return this;},onScroll:function(callback){updateScrollEvents(callback);return this;},release:function(){element.removeEventListener('mousedown',handleMouseDown);element.removeEventListener('touchstart',handleTouchStart);documentEvents.off('mousemove',handleMouseMove);documentEvents.off('mouseup',handleMouseUp);documentEvents.off('touchmove',handleTouchMove);documentEvents.off('touchend',handleTouchEnd);documentEvents.off('touchcancel',handleTouchEnd);updateScrollEvents(null);}};}},{"../Utils/browserInfo.js":39,"../Utils/documentEvents.js":40,"../Utils/findElementPosition.js":41}],36:[function(require,module,exports){module.exports=webglInputManager;var createInputEvents=require('../WebGL/webglInputEvents.js');function webglInputManager(graph,graphics){var inputEvents=createInputEvents(graphics),draggedNode=null,internalHandlers={},pos={x:0,y:0};inputEvents.mouseDown(function(node,e){draggedNode=node;pos.x=e.clientX;pos.y=e.clientY;inputEvents.mouseCapture(draggedNode);var handlers=internalHandlers[node.id];if(handlers&&handlers.onStart){handlers.onStart(e,pos);}
return true;}).mouseUp(function(node){inputEvents.releaseMouseCapture(draggedNode);draggedNode=null;var handlers=internalHandlers[node.id];if(handlers&&handlers.onStop){handlers.onStop();}
return true;}).mouseMove(function(node,e){if(draggedNode){var handlers=internalHandlers[draggedNode.id];if(handlers&&handlers.onDrag){handlers.onDrag(e,{x:e.clientX-pos.x,y:e.clientY-pos.y});}
pos.x=e.clientX;pos.y=e.clientY;return true;}});return{bindDragNDrop:function(node,handlers){internalHandlers[node.id]=handlers;if(!handlers){delete internalHandlers[node.id];}}};}},{"../WebGL/webglInputEvents.js":57}],37:[function(require,module,exports){module.exports=constant;var merge=require('ngraph.merge');var random=require('ngraph.random').random;var Rect=require('../Utils/rect.js');function constant(graph,userSettings){userSettings=merge(userSettings,{maxX:1024,maxY:1024,seed:'Deterministic randomness made me do this'});var rand=random(userSettings.seed),graphRect=new Rect(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),layoutLinks={},placeNodeCallback=function(node){return{x:rand.next(userSettings.maxX),y:rand.next(userSettings.maxY)};},updatechartViewRect=function(position,graphRect){if(position.x<graphRect.x1){graphRect.x1=position.x;}
if(position.x>graphRect.x2){graphRect.x2=position.x;}
if(position.y<graphRect.y1){graphRect.y1=position.y;}
if(position.y>graphRect.y2){graphRect.y2=position.y;}},layoutNodes=typeof Object.create==='function'?Object.create(null):{},ensureNodeInitialized=function(node){layoutNodes[node.id]=placeNodeCallback(node);updatechartViewRect(layoutNodes[node.id],graphRect);},updateNodePositions=function(){if(graph.getNodesCount()===0){return;}
graphRect.x1=Number.MAX_VALUE;graphRect.y1=Number.MAX_VALUE;graphRect.x2=Number.MIN_VALUE;graphRect.y2=Number.MIN_VALUE;graph.forEachNode(ensureNodeInitialized);},ensureLinkInitialized=function(link){layoutLinks[link.id]=link;},onchartViewChanged=function(changes){for(var i=0;i<changes.length;++i){var change=changes[i];if(change.node){if(change.changeType==='add'){ensureNodeInitialized(change.node);}else{delete layoutNodes[change.node.id];}}
if(change.link){if(change.changeType==='add'){ensureLinkInitialized(change.link);}else{delete layoutLinks[change.link.id];}}}};graph.forEachNode(ensureNodeInitialized);graph.forEachLink(ensureLinkInitialized);graph.on('changed',onchartViewChanged);return{run:function(iterationsCount){this.step();},step:function(){updateNodePositions();return true;},getchartViewRect:function(){return graphRect;},dispose:function(){graph.off('change',onchartViewChanged);},isNodePinned:function(node){return true;},pinNode:function(node,isPinned){},getNodePosition:getNodePosition,getLinkPosition:function(linkId){var link=layoutLinks[linkId];return{from:getNodePosition(link.fromId),to:getNodePosition(link.toId)};},setNodePosition:function(nodeId,x,y){var pos=layoutNodes[nodeId];if(pos){pos.x=x;pos.y=y;}},placeNode:function(newPlaceNodeCallbackOrNode){if(typeof newPlaceNodeCallbackOrNode==='function'){placeNodeCallback=newPlaceNodeCallbackOrNode;updateNodePositions();return this;}
return placeNodeCallback(newPlaceNodeCallbackOrNode);}};function getNodePosition(nodeId){return layoutNodes[nodeId];}}},{"../Utils/rect.js":45,"ngraph.merge":13,"ngraph.random":26}],38:[function(require,module,exports){var events=require('ngraph.events');module.exports=backwardCompatibleEvents;function backwardCompatibleEvents(g){console.log("This method is deprecated. Please use nokhbe.events() instead");if(!g){return g;}
var eventsDefined=(g.on!==undefined)||(g.off!==undefined)||(g.fire!==undefined);if(eventsDefined){return{extend:function(){return g;},on:g.on,stop:g.off};}
return{extend:extend,on:g.on,stop:g.off};function extend(){var backwardCompatible=events(g);backwardCompatible.addEventListener=backwardCompatible.on;return backwardCompatible;}}},{"ngraph.events":7}],39:[function(require,module,exports){module.exports=browserInfo();function browserInfo(){if(typeof window==="undefined"||!window.hasOwnProperty("navigator")){return{browser:"",version:"0"};}
var ua=window.navigator.userAgent.toLowerCase(),rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||(ua.indexOf("compatible")<0&&rmozilla.exec(ua))||[];return{browser:match[1]||"",version:match[2]||"0"};}},{}],40:[function(require,module,exports){var nullEvents=require('./nullEvents.js');module.exports=createDocumentEvents();function createDocumentEvents(){if(typeof document===undefined){return nullEvents;}
return{on:on,off:off};}
function on(eventName,handler){document.addEventListener(eventName,handler);}
function off(eventName,handler){document.removeEventListener(eventName,handler);}},{"./nullEvents.js":44}],41:[function(require,module,exports){module.exports=findElementPosition;function findElementPosition(obj){var curleft=0,curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while((obj=obj.offsetParent)!==null);}
return[curleft,curtop];}},{}],42:[function(require,module,exports){module.exports=getDimension;function getDimension(container){if(!container){throw{message:'Cannot get dimensions of undefined container'};}
var width=container.clientWidth;var height=container.clientHeight;return{left:0,top:0,width:width,height:height};}},{}],43:[function(require,module,exports){var intersect=require('gintersect');module.exports=intersectRect;function intersectRect(left,top,right,bottom,x1,y1,x2,y2){return intersect(left,top,left,bottom,x1,y1,x2,y2)||intersect(left,bottom,right,bottom,x1,y1,x2,y2)||intersect(right,bottom,right,top,x1,y1,x2,y2)||intersect(right,top,left,top,x1,y1,x2,y2);}},{"gintersect":3}],44:[function(require,module,exports){module.exports=createNullEvents();function createNullEvents(){return{on:noop,off:noop,stop:noop};}
function noop(){}},{}],45:[function(require,module,exports){module.exports=Rect;function Rect(x1,y1,x2,y2){this.x1=x1||0;this.y1=y1||0;this.x2=x2||0;this.y2=y2||0;}},{}],46:[function(require,module,exports){(function(global){module.exports=createTimer();function createTimer(){var lastTime=0,vendors=['ms','moz','webkit','o'],i,scope;if(typeof window!=='undefined'){scope=window;}else if(typeof global!=='undefined'){scope=global;}else{scope={setTimeout:noop,clearTimeout:noop};}
for(i=0;i<vendors.length&&!scope.requestAnimationFrame;++i){var vendorPrefix=vendors[i];scope.requestAnimationFrame=scope[vendorPrefix+'RequestAnimationFrame'];scope.cancelAnimationFrame=scope[vendorPrefix+'CancelAnimationFrame']||scope[vendorPrefix+'CancelRequestAnimationFrame'];}
if(!scope.requestAnimationFrame){scope.requestAnimationFrame=rafPolyfill;}
if(!scope.cancelAnimationFrame){scope.cancelAnimationFrame=cancelRafPolyfill;}
return timer;function timer(callback){var intervalId;startTimer();return{stop:stopTimer,restart:restart};function startTimer(){intervalId=scope.requestAnimationFrame(startTimer);if(!callback()){stopTimer();}}
function stopTimer(){scope.cancelAnimationFrame(intervalId);intervalId=0;}
function restart(){if(!intervalId){startTimer();}}}
function rafPolyfill(callback){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=scope.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;}
function cancelRafPolyfill(id){scope.clearTimeout(id);}}
function noop(){}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],47:[function(require,module,exports){var nullEvents=require('./nullEvents.js');module.exports=createDocumentEvents();function createDocumentEvents(){if(typeof window==='undefined'){return nullEvents;}
return{on:on,off:off};}
function on(eventName,handler){window.addEventListener(eventName,handler);}
function off(eventName,handler){window.removeEventListener(eventName,handler);}},{"./nullEvents.js":44}],48:[function(require,module,exports){module.exports=renderer;var eventify=require('ngraph.events');var forceDirected=require('ngraph.forcelayout');var svgchartViewics=require('./svgchartViewics.js');var windowEvents=require('../Utils/windowEvents.js');var domInputManager=require('../Input/domInputManager.js');var timer=require('../Utils/timer.js');var getDimension=require('../Utils/getDimensions.js');var dragndrop=require('../Input/dragndrop.js');function renderer(graph,settings){var FRAME_INTERVAL=30;settings=settings||{};var layout=settings.layout,graphics=settings.graphics,container=settings.container,interactive=settings.interactive!==undefined?settings.interactive:true,inputManager,animationTimer,rendererInitialized=false,updateCenterRequired=true,currentStep=0,totalIterationsCount=0,isStable=false,userInteraction=false,isPaused=false,transform={offsetX:0,offsetY:0,scale:1},publicEvents=eventify({}),containerDrag;return{run:function(iterationsCount){if(!rendererInitialized){prepareSettings();prerender();initDom();updateCenter();listenToEvents();rendererInitialized=true;}
renderIterations(iterationsCount);return this;},reset:function(){graphics.resetScale();updateCenter();transform.scale=1;},pause:function(){isPaused=true;animationTimer.stop();},resume:function(){isPaused=false;animationTimer.restart();},rerender:function(){renderchartView();return this;},zoomOut:function(){return scale(true);},zoomIn:function(){return scale(false);},moveTo:function(x,y){graphics.graphCenterChanged(transform.offsetX-x*transform.scale,transform.offsetY-y*transform.scale);renderchartView();},getchartViewics:function(){return graphics;},dispose:function(){stopListenToEvents();},on:function(eventName,callback){publicEvents.on(eventName,callback);return this;},off:function(eventName,callback){publicEvents.off(eventName,callback);return this;}};function isInteractive(interactionName){if(typeof interactive==='string'){return interactive.indexOf(interactionName)>=0;}else if(typeof interactive==='boolean'){return interactive;}
return true;}
function prepareSettings(){container=container||window.document.body;layout=layout||forceDirected(graph,{springLength:80,springCoeff:0.0002,});graphics=graphics||svgchartViewics(graph,{container:container});if(!settings.hasOwnProperty('renderLinks')){settings.renderLinks=true;}
settings.prerender=settings.prerender||0;inputManager=(graphics.inputManager||domInputManager)(graph,graphics);}
function renderchartView(){graphics.beginRender();if(settings.renderLinks){graphics.renderLinks();}
graphics.renderNodes();graphics.endRender();}
function onRenderFrame(){isStable=layout.step()&&!userInteraction;renderchartView();return!isStable;}
function renderIterations(iterationsCount){if(animationTimer){totalIterationsCount+=iterationsCount;return;}
if(iterationsCount){totalIterationsCount+=iterationsCount;animationTimer=timer(function(){return onRenderFrame();},FRAME_INTERVAL);}else{currentStep=0;totalIterationsCount=0;animationTimer=timer(onRenderFrame,FRAME_INTERVAL);}}
function resetStable(){if(isPaused){return;}
isStable=false;animationTimer.restart();}
function prerender(){if(typeof settings.prerender==='number'&&settings.prerender>0){for(var i=0;i<settings.prerender;i+=1){layout.step();}}}
function updateCenter(){var graphRect=layout.getchartViewRect(),containerSize=getDimension(container);var cx=(graphRect.x2+graphRect.x1)/ 2;var cy=(graphRect.y2+graphRect.y1)/ 2;transform.offsetX=containerSize.width / 2-(cx*transform.scale-cx);transform.offsetY=containerSize.height / 2-(cy*transform.scale-cy);graphics.graphCenterChanged(transform.offsetX,transform.offsetY);updateCenterRequired=false;}
function createNodeUi(node){var nodePosition=layout.getNodePosition(node.id);graphics.addNode(node,nodePosition);}
function removeNodeUi(node){graphics.releaseNode(node);}
function createLinkUi(link){var linkPosition=layout.getLinkPosition(link.id);graphics.addLink(link,linkPosition);}
function removeLinkUi(link){graphics.releaseLink(link);}
function listenNodeEvents(node){if(!isInteractive('node')){return;}
var wasPinned=false;inputManager.bindDragNDrop(node,{onStart:function(){wasPinned=layout.isNodePinned(node);layout.pinNode(node,true);userInteraction=true;resetStable();},onDrag:function(e,offset){var oldPos=layout.getNodePosition(node.id);layout.setNodePosition(node.id,oldPos.x+offset.x / transform.scale,oldPos.y+offset.y / transform.scale);userInteraction=true;renderchartView();},onStop:function(){layout.pinNode(node,wasPinned);userInteraction=false;}});}
function releaseNodeEvents(node){inputManager.bindDragNDrop(node,null);}
function initDom(){graphics.init(container);graph.forEachNode(createNodeUi);if(settings.renderLinks){graph.forEachLink(createLinkUi);}}
function releaseDom(){graphics.release(container);}
function processNodeChange(change){var node=change.node;if(change.changeType==='add'){createNodeUi(node);listenNodeEvents(node);if(updateCenterRequired){updateCenter();}}else if(change.changeType==='remove'){releaseNodeEvents(node);removeNodeUi(node);if(graph.getNodesCount()===0){updateCenterRequired=true;}}else if(change.changeType==='update'){releaseNodeEvents(node);removeNodeUi(node);createNodeUi(node);listenNodeEvents(node);}}
function processLinkChange(change){var link=change.link;if(change.changeType==='add'){if(settings.renderLinks){createLinkUi(link);}}else if(change.changeType==='remove'){if(settings.renderLinks){removeLinkUi(link);}}else if(change.changeType==='update'){throw'Update type is not implemented. TODO: Implement me!';}}
function onchartViewChanged(changes){var i,change;for(i=0;i<changes.length;i+=1){change=changes[i];if(change.node){processNodeChange(change);}else if(change.link){processLinkChange(change);}}
resetStable();}
function onWindowResized(){updateCenter();onRenderFrame();}
function releaseContainerDragManager(){if(containerDrag){containerDrag.release();containerDrag=null;}}
function releasechartViewEvents(){graph.off('changed',onchartViewChanged);}
function scale(out,scrollPoint){if(!scrollPoint){var containerSize=getDimension(container);scrollPoint={x:containerSize.width / 2,y:containerSize.height / 2};}
var scaleFactor=Math.pow(1+0.4,out?-0.2:0.2);transform.scale=graphics.scale(scaleFactor,scrollPoint);renderchartView();publicEvents.fire('scale',transform.scale);return transform.scale;}
function listenToEvents(){windowEvents.on('resize',onWindowResized);releaseContainerDragManager();if(isInteractive('drag')){containerDrag=dragndrop(container);containerDrag.onDrag(function(e,offset){graphics.translateRel(offset.x,offset.y);renderchartView();publicEvents.fire('drag',offset);});}
if(isInteractive('scroll')){if(!containerDrag){containerDrag=dragndrop(container);}
containerDrag.onScroll(function(e,scaleOffset,scrollPoint){scale(scaleOffset<0,scrollPoint);});}
graph.forEachNode(listenNodeEvents);releasechartViewEvents();graph.on('changed',onchartViewChanged);}
function stopListenToEvents(){rendererInitialized=false;releasechartViewEvents();releaseContainerDragManager();windowEvents.off('resize',onWindowResized);publicEvents.off();animationTimer.stop();graph.forEachLink(function(link){if(settings.renderLinks){removeLinkUi(link);}});graph.forEachNode(function(node){releaseNodeEvents(node);removeNodeUi(node);});layout.dispose();releaseDom();}}},{"../Input/domInputManager.js":34,"../Input/dragndrop.js":35,"../Utils/getDimensions.js":42,"../Utils/timer.js":46,"../Utils/windowEvents.js":47,"./svgchartViewics.js":49,"ngraph.events":7,"ngraph.forcelayout":9}],49:[function(require,module,exports){module.exports=svgchartViewics;var svg=require('simplesvg');var eventify=require('ngraph.events');var domInputManager=require('../Input/domInputManager.js');function svgchartViewics(){var svgContainer,svgRoot,offsetX=0,offsetY=0,initCallback,actualScale=1,allNodes={},allLinks={},nodeBuilder=function(node){return svg("rect").attr("width",10).attr("height",10).attr("fill","#00a2e8");},nodePositionCallback=function(nodeUI,pos){nodeUI.attr("x",pos.x-5).attr("y",pos.y-5);},linkBuilder=function(link){return svg("line").attr("stroke","#999");},linkPositionCallback=function(linkUI,fromPos,toPos){linkUI.attr("x1",fromPos.x).attr("y1",fromPos.y).attr("x2",toPos.x).attr("y2",toPos.y);},fireRescaled=function(graphics){graphics.fire("rescaled");},cachedPos={x:0,y:0},cachedFromPos={x:0,y:0},cachedToPos={x:0,y:0},updateTransform=function(){if(svgContainer){var transform="matrix("+actualScale+", 0, 0,"+actualScale+","+offsetX+","+offsetY+")";svgContainer.attr("transform",transform);}};svgRoot=createSvgRoot();var graphics={getNodeUI:function(nodeId){return allNodes[nodeId];},getLinkUI:function(linkId){return allLinks[linkId];},node:function(builderCallback){if(typeof builderCallback!=="function"){return;}
nodeBuilder=builderCallback;return this;},link:function(builderCallback){if(typeof builderCallback!=="function"){return;}
linkBuilder=builderCallback;return this;},placeNode:function(newPlaceCallback){nodePositionCallback=newPlaceCallback;return this;},placeLink:function(newPlaceLinkCallback){linkPositionCallback=newPlaceLinkCallback;return this;},beginRender:function(){},endRender:function(){},graphCenterChanged:function(x,y){offsetX=x;offsetY=y;updateTransform();},inputManager:domInputManager,translateRel:function(dx,dy){var p=svgRoot.createSVGPoint(),t=svgContainer.getCTM(),origin=svgRoot.createSVGPoint().matrixTransform(t.inverse());p.x=dx;p.y=dy;p=p.matrixTransform(t.inverse());p.x=(p.x-origin.x)*t.a;p.y=(p.y-origin.y)*t.d;t.e+=p.x;t.f+=p.y;var transform="matrix("+t.a+", 0, 0,"+t.d+","+t.e+","+t.f+")";svgContainer.attr("transform",transform);},scale:function(scaleFactor,scrollPoint){var p=svgRoot.createSVGPoint();p.x=scrollPoint.x;p.y=scrollPoint.y;p=p.matrixTransform(svgContainer.getCTM().inverse());var k=svgRoot.createSVGMatrix().translate(p.x,p.y).scale(scaleFactor).translate(-p.x,-p.y),t=svgContainer.getCTM().multiply(k);actualScale=t.a;offsetX=t.e;offsetY=t.f;var transform="matrix("+t.a+", 0, 0,"+t.d+","+t.e+","+t.f+")";svgContainer.attr("transform",transform);fireRescaled(this);return actualScale;},resetScale:function(){actualScale=1;var transform="matrix(1, 0, 0, 1, 0, 0)";svgContainer.attr("transform",transform);fireRescaled(this);return this;},init:function(container){container.appendChild(svgRoot);updateTransform();if(typeof initCallback==="function"){initCallback(svgRoot);}},release:function(container){if(svgRoot&&container){container.removeChild(svgRoot);}},addLink:function(link,pos){var linkUI=linkBuilder(link);if(!linkUI){return;}
linkUI.position=pos;linkUI.link=link;allLinks[link.id]=linkUI;if(svgContainer.childElementCount>0){svgContainer.insertBefore(linkUI,svgContainer.firstChild);}else{svgContainer.appendChild(linkUI);}
return linkUI;},releaseLink:function(link){var linkUI=allLinks[link.id];if(linkUI){svgContainer.removeChild(linkUI);delete allLinks[link.id];}},addNode:function(node,pos){var nodeUI=nodeBuilder(node);if(!nodeUI){return;}
nodeUI.position=pos;nodeUI.node=node;allNodes[node.id]=nodeUI;nodeUI.setAttribute('name',node.data.name);nodeUI.setAttribute('field',node.data.field);nodeUI.setAttribute('connectTo',node.data.connectTo);nodeUI.setAttribute('id',node.id);svgContainer.appendChild(nodeUI);return nodeUI;},releaseNode:function(node){var nodeUI=allNodes[node.id];if(nodeUI){svgContainer.removeChild(nodeUI);delete allNodes[node.id];}},renderNodes:function(){for(var key in allNodes){if(allNodes.hasOwnProperty(key)){var nodeUI=allNodes[key];cachedPos.x=nodeUI.position.x;cachedPos.y=nodeUI.position.y;nodePositionCallback(nodeUI,cachedPos,nodeUI.node);}}},renderLinks:function(){for(var key in allLinks){if(allLinks.hasOwnProperty(key)){var linkUI=allLinks[key];cachedFromPos.x=linkUI.position.from.x;cachedFromPos.y=linkUI.position.from.y;cachedToPos.x=linkUI.position.to.x;cachedToPos.y=linkUI.position.to.y;linkPositionCallback(linkUI,cachedFromPos,cachedToPos,linkUI.link);}}},getchartViewicsRoot:function(callbackWhenReady){if(typeof callbackWhenReady==="function"){if(svgRoot){callbackWhenReady(svgRoot);}else{initCallback=callbackWhenReady;}}
return svgRoot;},getSvgRoot:function(){return svgRoot;}};eventify(graphics);return graphics;function createSvgRoot(){var svgRoot=svg("svg");svgContainer=svg("g").attr("buffered-rendering","dynamic");svgRoot.appendChild(svgContainer);return svgRoot;}}},{"../Input/domInputManager.js":34,"ngraph.events":7,"simplesvg":28}],50:[function(require,module,exports){module.exports=webglchartViewics;var webglInputManager=require('../Input/webglInputManager.js');var webglLinkProgram=require('../WebGL/webglLinkProgram.js');var webglNodeProgram=require('../WebGL/webglNodeProgram.js');var webglSquare=require('../WebGL/webglSquare.js');var webglLine=require('../WebGL/webglLine.js');var eventify=require('ngraph.events');var merge=require('ngraph.merge');function webglchartViewics(options){options=merge(options,{enableBlending:true,preserveDrawingBuffer:false,clearColor:false,clearColorValue:{r:1,g:1,b:1,a:1}});var container,graphicsRoot,gl,width,height,nodesCount=0,linksCount=0,transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],userPlaceNodeCallback,userPlaceLinkCallback,nodes=[],links=[],initCallback,allNodes={},allLinks={},linkProgram=webglLinkProgram(),nodeProgram=webglNodeProgram(),nodeUIBuilder=function(node){return webglSquare();},linkUIBuilder=function(link){return webglLine(0xb3b3b3ff);},updateTransformUniform=function(){linkProgram.updateTransform(transform);nodeProgram.updateTransform(transform);},resetScaleInternal=function(){transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];},updateSize=function(){if(container&&graphicsRoot){width=graphicsRoot.width=Math.max(container.offsetWidth,1);height=graphicsRoot.height=Math.max(container.offsetHeight,1);if(gl){gl.viewport(0,0,width,height);}
if(linkProgram){linkProgram.updateSize(width / 2,height / 2);}
if(nodeProgram){nodeProgram.updateSize(width / 2,height / 2);}}},fireRescaled=function(graphics){graphics.fire("rescaled");};graphicsRoot=window.document.createElement("canvas");var graphics={getLinkUI:function(linkId){return allLinks[linkId];},getNodeUI:function(nodeId){return allNodes[nodeId];},node:function(builderCallback){if(typeof builderCallback!=="function"){return;}
nodeUIBuilder=builderCallback;return this;},link:function(builderCallback){if(typeof builderCallback!=="function"){return;}
linkUIBuilder=builderCallback;return this;},placeNode:function(newPlaceCallback){userPlaceNodeCallback=newPlaceCallback;return this;},placeLink:function(newPlaceLinkCallback){userPlaceLinkCallback=newPlaceLinkCallback;return this;},inputManager:webglInputManager,beginRender:function(){},endRender:function(){if(linksCount>0){linkProgram.render();}
if(nodesCount>0){nodeProgram.render();}},bringLinkToFront:function(linkUI){var frontLinkId=linkProgram.getFrontLinkId(),srcLinkId,temp;linkProgram.bringToFront(linkUI);if(frontLinkId>linkUI.id){srcLinkId=linkUI.id;temp=links[frontLinkId];links[frontLinkId]=links[srcLinkId];links[frontLinkId].id=frontLinkId;links[srcLinkId]=temp;links[srcLinkId].id=srcLinkId;}},graphCenterChanged:function(x,y){transform[12]=(2*x / width)-1;transform[13]=1-(2*y / height);updateTransformUniform();},addLink:function(link,boundPosition){var uiid=linksCount++,ui=linkUIBuilder(link);ui.id=uiid;ui.pos=boundPosition;linkProgram.createLink(ui);links[uiid]=ui;allLinks[link.id]=ui;return ui;},addNode:function(node,boundPosition){var uiid=nodesCount++,ui=nodeUIBuilder(node);ui.id=uiid;ui.position=boundPosition;ui.node=node;nodeProgram.createNode(ui);nodes[uiid]=ui;allNodes[node.id]=ui;return ui;},translateRel:function(dx,dy){transform[12]+=(2*transform[0]*dx / width)/ transform[0];transform[13]-=(2*transform[5]*dy / height)/ transform[5];updateTransformUniform();},scale:function(scaleFactor,scrollPoint){var cx=2*scrollPoint.x / width-1,cy=1-(2*scrollPoint.y)/ height;cx-=transform[12];cy-=transform[13];transform[12]+=cx*(1-scaleFactor);transform[13]+=cy*(1-scaleFactor);transform[0]*=scaleFactor;transform[5]*=scaleFactor;updateTransformUniform();fireRescaled(this);return transform[0];},resetScale:function(){resetScaleInternal();if(gl){updateSize();updateTransformUniform();}
return this;},init:function(c){var contextParameters={};if(options.preserveDrawingBuffer){contextParameters.preserveDrawingBuffer=true;}
container=c;updateSize();resetScaleInternal();container.appendChild(graphicsRoot);gl=graphicsRoot.getContext("experimental-webgl",contextParameters);if(!gl){var msg="Could not initialize WebGL. Seems like the browser doesn't support it.";window.alert(msg);throw msg;}
if(options.enableBlending){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.BLEND);}
if(options.clearColor){var color=options.clearColorValue;gl.clearColor(color.r,color.g,color.b,color.a);this.beginRender=function(){gl.clear(gl.COLOR_BUFFER_BIT);};}
linkProgram.load(gl);linkProgram.updateSize(width / 2,height / 2);nodeProgram.load(gl);nodeProgram.updateSize(width / 2,height / 2);updateTransformUniform();if(typeof initCallback==="function"){initCallback(graphicsRoot);}},release:function(container){if(graphicsRoot&&container){container.removeChild(graphicsRoot);}},isSupported:function(){var c=window.document.createElement("canvas"),gl=c&&c.getContext&&c.getContext("experimental-webgl");return gl;},releaseLink:function(link){if(linksCount>0){linksCount-=1;}
var linkUI=allLinks[link.id];delete allLinks[link.id];linkProgram.removeLink(linkUI);var linkIdToRemove=linkUI.id;if(linkIdToRemove<linksCount){if(linksCount===0||linksCount===linkIdToRemove){return;}
var lastLinkUI=links[linksCount];links[linkIdToRemove]=lastLinkUI;lastLinkUI.id=linkIdToRemove;}},releaseNode:function(node){if(nodesCount>0){nodesCount-=1;}
var nodeUI=allNodes[node.id];delete allNodes[node.id];nodeProgram.removeNode(nodeUI);var nodeIdToRemove=nodeUI.id;if(nodeIdToRemove<nodesCount){if(nodesCount===0||nodesCount===nodeIdToRemove){return;}
var lastNodeUI=nodes[nodesCount];nodes[nodeIdToRemove]=lastNodeUI;lastNodeUI.id=nodeIdToRemove;nodeProgram.replaceProperties(nodeUI,lastNodeUI);}},renderNodes:function(){var pos={x:0,y:0};for(var i=0;i<nodesCount;++i){var ui=nodes[i];pos.x=ui.position.x;pos.y=ui.position.y;if(userPlaceNodeCallback){userPlaceNodeCallback(ui,pos);}
nodeProgram.position(ui,pos);}},renderLinks:function(){if(this.omitLinksRendering){return;}
var toPos={x:0,y:0};var fromPos={x:0,y:0};for(var i=0;i<linksCount;++i){var ui=links[i];var pos=ui.pos.from;fromPos.x=pos.x;fromPos.y=-pos.y;pos=ui.pos.to;toPos.x=pos.x;toPos.y=-pos.y;if(userPlaceLinkCallback){userPlaceLinkCallback(ui,fromPos,toPos);}
linkProgram.position(ui,fromPos,toPos);}},getchartViewicsRoot:function(callbackWhenReady){if(typeof callbackWhenReady==="function"){if(graphicsRoot){callbackWhenReady(graphicsRoot);}else{initCallback=callbackWhenReady;}}
return graphicsRoot;},setNodeProgram:function(newProgram){if(!gl&&newProgram){nodeProgram=newProgram;}else if(newProgram){throw"Not implemented. Cannot swap shader on the fly... Yet.";}},setLinkProgram:function(newProgram){if(!gl&&newProgram){linkProgram=newProgram;}else if(newProgram){throw"Not implemented. Cannot swap shader on the fly... Yet.";}},transformClientTochartViewCoordinates:function(p){p.x=((2*p.x)/ width)-1;p.y=1-((2*p.y)/ height);p.x=(p.x-transform[12])/ transform[0];p.y=(p.y-transform[13])/ transform[5];p.x=p.x*(width / 2);p.y=p.y*(-height / 2);return p;},transformchartViewToClientCoordinates:function(p){p.x=p.x /(width / 2);p.y=p.y /(-height / 2);p.x=(p.x*transform[0])+transform[12];p.y=(p.y*transform[5])+transform[13];p.x=((p.x+1)*width)/ 2;p.y=((1-p.y)*height)/ 2;return p;},getNodeAtClientPos:function(clientPos,preciseCheck){if(typeof preciseCheck!=="function"){return null;}
this.transformClientTochartViewCoordinates(clientPos);for(var i=0;i<nodesCount;++i){if(preciseCheck(nodes[i],clientPos.x,clientPos.y)){return nodes[i].node;}}
return null;}};eventify(graphics);return graphics;}},{"../Input/webglInputManager.js":36,"../WebGL/webglLine.js":58,"../WebGL/webglLinkProgram.js":59,"../WebGL/webglNodeProgram.js":60,"../WebGL/webglSquare.js":61,"ngraph.events":7,"ngraph.merge":13}],51:[function(require,module,exports){module.exports=parseColor;function parseColor(color){var parsedColor=0x009ee8ff;if(typeof color==='string'&&color){if(color.length===4){color=color.replace(/([^#])/g,'$1$1');}
if(color.length===9){parsedColor=parseInt(color.substr(1),16);}else if(color.length===7){parsedColor=(parseInt(color.substr(1),16)<<8)|0xff;}else{throw'Color expected in hex format with preceding "#". E.g. #00ff00. Got value: '+color;}}else if(typeof color==='number'){parsedColor=color;}
return parsedColor;}},{}],52:[function(require,module,exports){module.exports=Texture;function Texture(size){this.canvas=window.document.createElement("canvas");this.ctx=this.canvas.getContext("2d");this.isDirty=false;this.canvas.width=this.canvas.height=size;}},{}],53:[function(require,module,exports){module.exports=webgl;function webgl(gl){return{createProgram:createProgram,extendArray:extendArray,copyArrayPart:copyArrayPart,swapArrayPart:swapArrayPart,getLocations:getLocations,context:gl};function createShader(shaderText,type){var shader=gl.createShader(type);gl.shaderSource(shader,shaderText);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var msg=gl.getShaderInfoLog(shader);window.alert(msg);throw msg;}
return shader;}
function createProgram(vertexShaderSrc,fragmentShaderSrc){var program=gl.createProgram();var vs=createShader(vertexShaderSrc,gl.VERTEX_SHADER);var fs=createShader(fragmentShaderSrc,gl.FRAGMENT_SHADER);gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){var msg=gl.getShaderInfoLog(program);window.alert(msg);throw msg;}
return program;}
function extendArray(buffer,itemsInBuffer,elementsPerItem){if((itemsInBuffer+1)*elementsPerItem>buffer.length){var extendedArray=new Float32Array(buffer.length*elementsPerItem*2);extendedArray.set(buffer);return extendedArray;}
return buffer;}
function getLocations(program,uniformOrAttributeNames){var foundLocations={};for(var i=0;i<uniformOrAttributeNames.length;++i){var name=uniformOrAttributeNames[i];var location=-1;if(name[0]==='a'&&name[1]==='_'){location=gl.getAttribLocation(program,name);if(location===-1){throw new Error("Program doesn't have required attribute: "+name);}
foundLocations[name.slice(2)]=location;}else if(name[0]==='u'&&name[1]==='_'){location=gl.getUniformLocation(program,name);if(location===null){throw new Error("Program doesn't have required uniform: "+name);}
foundLocations[name.slice(2)]=location;}else{throw new Error("Couldn't figure out your intent. All uniforms should start with 'u_' prefix, and attributes with 'a_'");}}
return foundLocations;}}
function copyArrayPart(array,to,from,elementsCount){for(var i=0;i<elementsCount;++i){array[to+i]=array[from+i];}}
function swapArrayPart(array,from,to,elementsCount){for(var i=0;i<elementsCount;++i){var tmp=array[from+i];array[from+i]=array[to+i];array[to+i]=tmp;}}},{}],54:[function(require,module,exports){var Texture=require('./texture.js');module.exports=webglAtlas;function webglAtlas(tilesPerTexture){var tilesPerRow=Math.sqrt(tilesPerTexture||1024)<<0,tileSize=tilesPerRow,lastLoadedIdx=1,loadedImages={},dirtyTimeoutId,skipedDirty=0,textures=[],trackedUrls=[];if(!isPowerOf2(tilesPerTexture)){throw"Tiles per texture should be power of two.";}
var api={isDirty:false,clearDirty:clearDirty,remove:remove,getTextures:getTextures,getCoordinates:getCoordinates,load:load};return api;function clearDirty(){var i;api.isDirty=false;for(i=0;i<textures.length;++i){textures[i].isDirty=false;}}
function remove(imgUrl){var coordinates=loadedImages[imgUrl];if(!coordinates){return false;}
delete loadedImages[imgUrl];lastLoadedIdx-=1;if(lastLoadedIdx===coordinates.offset){return true;}
var tileToRemove=getTileCoordinates(coordinates.offset),lastTileInSet=getTileCoordinates(lastLoadedIdx);copy(lastTileInSet,tileToRemove);var replacedOffset=loadedImages[trackedUrls[lastLoadedIdx]];replacedOffset.offset=coordinates.offset;trackedUrls[coordinates.offset]=trackedUrls[lastLoadedIdx];markDirty();return true;}
function getTextures(){return textures;}
function getCoordinates(imgUrl){return loadedImages[imgUrl];}
function load(imgUrl,callback){if(loadedImages.hasOwnProperty(imgUrl)){callback(loadedImages[imgUrl]);}else{var img=new window.Image(),imgId=lastLoadedIdx;lastLoadedIdx+=1;img.crossOrigin="anonymous";img.onload=function(){markDirty();drawAt(imgId,img,callback);};img.src=imgUrl;}}
function createTexture(){var texture=new Texture(tilesPerRow*tileSize);textures.push(texture);}
function drawAt(tileNumber,img,callback){var tilePosition=getTileCoordinates(tileNumber),coordinates={offset:tileNumber};if(tilePosition.textureNumber>=textures.length){createTexture();}
var currentTexture=textures[tilePosition.textureNumber];currentTexture.ctx.drawImage(img,tilePosition.col*tileSize,tilePosition.row*tileSize,tileSize,tileSize);trackedUrls[tileNumber]=img.src;loadedImages[img.src]=coordinates;currentTexture.isDirty=true;callback(coordinates);}
function getTileCoordinates(absolutePosition){var textureNumber=(absolutePosition / tilesPerTexture)<<0,localTileNumber=(absolutePosition%tilesPerTexture),row=(localTileNumber / tilesPerRow)<<0,col=(localTileNumber%tilesPerRow);return{textureNumber:textureNumber,row:row,col:col};}
function markDirtyNow(){api.isDirty=true;skipedDirty=0;dirtyTimeoutId=null;}
function markDirty(){if(dirtyTimeoutId){window.clearTimeout(dirtyTimeoutId);skipedDirty+=1;dirtyTimeoutId=null;}
if(skipedDirty>10){markDirtyNow();}else{dirtyTimeoutId=window.setTimeout(markDirtyNow,400);}}
function copy(from,to){var fromCanvas=textures[from.textureNumber].canvas,toCtx=textures[to.textureNumber].ctx,x=to.col*tileSize,y=to.row*tileSize;toCtx.drawImage(fromCanvas,from.col*tileSize,from.row*tileSize,tileSize,tileSize,x,y,tileSize,tileSize);textures[from.textureNumber].isDirty=true;textures[to.textureNumber].isDirty=true;}}
function isPowerOf2(n){return(n&(n-1))===0;}},{"./texture.js":52}],55:[function(require,module,exports){module.exports=webglImage;function webglImage(size,src){return{_texture:0,_offset:0,size:typeof size==='number'?size:32,src:src};}},{}],56:[function(require,module,exports){var WebglAtlas=require('./webglAtlas.js');var glUtils=require('./webgl.js');module.exports=webglImageNodeProgram;function webglImageNodeProgram(){var ATTRIBUTES_PER_PRIMITIVE=18;var nodesFS=createNodeFragmentShader();var nodesVS=createNodeVertexShader();var tilesPerTexture=1024;var atlas;var program;var gl;var buffer;var utils;var locations;var nodesCount=0;var nodes=new Float32Array(64);var width;var height;var transform;var sizeDirty;return{load:load,position:position,createNode:createNode,removeNode:removeNode,replaceProperties:replaceProperties,updateTransform:updateTransform,updateSize:updateSize,render:render};function refreshTexture(texture,idx){if(texture.nativeObject){gl.deleteTexture(texture.nativeObject);}
var nativeObject=gl.createTexture();gl.activeTexture(gl["TEXTURE"+idx]);gl.bindTexture(gl.TEXTURE_2D,nativeObject);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.canvas);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.generateMipmap(gl.TEXTURE_2D);gl.uniform1i(locations["sampler"+idx],idx);texture.nativeObject=nativeObject;}
function ensureAtlasTextureUpdated(){if(atlas.isDirty){var textures=atlas.getTextures(),i;for(i=0;i<textures.length;++i){if(textures[i].isDirty||!textures[i].nativeObject){refreshTexture(textures[i],i);}}
atlas.clearDirty();}}
function load(glContext){gl=glContext;utils=glUtils(glContext);atlas=new WebglAtlas(tilesPerTexture);program=utils.createProgram(nodesVS,nodesFS);gl.useProgram(program);locations=utils.getLocations(program,["a_vertexPos","a_customAttributes","u_screenSize","u_transform","u_sampler0","u_sampler1","u_sampler2","u_sampler3","u_tilesPerTexture"]);gl.uniform1f(locations.tilesPerTexture,tilesPerTexture);gl.enableVertexAttribArray(locations.vertexPos);gl.enableVertexAttribArray(locations.customAttributes);buffer=gl.createBuffer();}
function position(nodeUI,pos){var idx=nodeUI.id*ATTRIBUTES_PER_PRIMITIVE;nodes[idx]=pos.x-nodeUI.size;nodes[idx+1]=pos.y-nodeUI.size;nodes[idx+2]=nodeUI._offset*4;nodes[idx+3]=pos.x+nodeUI.size;nodes[idx+4]=pos.y-nodeUI.size;nodes[idx+5]=nodeUI._offset*4+1;nodes[idx+6]=pos.x-nodeUI.size;nodes[idx+7]=pos.y+nodeUI.size;nodes[idx+8]=nodeUI._offset*4+2;nodes[idx+9]=pos.x-nodeUI.size;nodes[idx+10]=pos.y+nodeUI.size;nodes[idx+11]=nodeUI._offset*4+2;nodes[idx+12]=pos.x+nodeUI.size;nodes[idx+13]=pos.y-nodeUI.size;nodes[idx+14]=nodeUI._offset*4+1;nodes[idx+15]=pos.x+nodeUI.size;nodes[idx+16]=pos.y+nodeUI.size;nodes[idx+17]=nodeUI._offset*4+3;}
function createNode(ui){nodes=utils.extendArray(nodes,nodesCount,ATTRIBUTES_PER_PRIMITIVE);nodesCount+=1;var coordinates=atlas.getCoordinates(ui.src);if(coordinates){ui._offset=coordinates.offset;}else{ui._offset=0;atlas.load(ui.src,function(coordinates){ui._offset=coordinates.offset;});}}
function removeNode(nodeUI){if(nodesCount>0){nodesCount-=1;}
if(nodeUI.id<nodesCount&&nodesCount>0){if(nodeUI.src){atlas.remove(nodeUI.src);}
utils.copyArrayPart(nodes,nodeUI.id*ATTRIBUTES_PER_PRIMITIVE,nodesCount*ATTRIBUTES_PER_PRIMITIVE,ATTRIBUTES_PER_PRIMITIVE);}}
function replaceProperties(replacedNode,newNode){newNode._offset=replacedNode._offset;}
function updateTransform(newTransform){sizeDirty=true;transform=newTransform;}
function updateSize(w,h){width=w;height=h;sizeDirty=true;}
function render(){gl.useProgram(program);gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,nodes,gl.DYNAMIC_DRAW);if(sizeDirty){sizeDirty=false;gl.uniformMatrix4fv(locations.transform,false,transform);gl.uniform2f(locations.screenSize,width,height);}
gl.vertexAttribPointer(locations.vertexPos,2,gl.FLOAT,false,3*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(locations.customAttributes,1,gl.FLOAT,false,3*Float32Array.BYTES_PER_ELEMENT,2*4);ensureAtlasTextureUpdated();gl.drawArrays(gl.TRIANGLES,0,nodesCount*6);}}
function createNodeFragmentShader(){return["precision mediump float;","varying vec4 color;","varying vec3 vTextureCoord;","uniform sampler2D u_sampler0;","uniform sampler2D u_sampler1;","uniform sampler2D u_sampler2;","uniform sampler2D u_sampler3;","void main(void) {","   if (vTextureCoord.z == 0.) {","     gl_FragColor = texture2D(u_sampler0, vTextureCoord.xy);","   } else if (vTextureCoord.z == 1.) {","     gl_FragColor = texture2D(u_sampler1, vTextureCoord.xy);","   } else if (vTextureCoord.z == 2.) {","     gl_FragColor = texture2D(u_sampler2, vTextureCoord.xy);","   } else if (vTextureCoord.z == 3.) {","     gl_FragColor = texture2D(u_sampler3, vTextureCoord.xy);","   } else { gl_FragColor = vec4(0, 1, 0, 1); }","}"].join("\n");}
function createNodeVertexShader(){return["attribute vec2 a_vertexPos;","attribute float a_customAttributes;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","uniform float u_tilesPerTexture;","varying vec3 vTextureCoord;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0, 1);","float corner = mod(a_customAttributes, 4.);","float tileIndex = mod(floor(a_customAttributes / 4.), u_tilesPerTexture);","float tilesPerRow = sqrt(u_tilesPerTexture);","float tileSize = 1./tilesPerRow;","float tileColumn = mod(tileIndex, tilesPerRow);","float tileRow = floor(tileIndex/tilesPerRow);","if(corner == 0.0) {","  vTextureCoord.xy = vec2(0, 1);","} else if(corner == 1.0) {","  vTextureCoord.xy = vec2(1, 1);","} else if(corner == 2.0) {","  vTextureCoord.xy = vec2(0, 0);","} else {","  vTextureCoord.xy = vec2(1, 0);","}","vTextureCoord *= tileSize;","vTextureCoord.x += tileColumn * tileSize;","vTextureCoord.y += tileRow * tileSize;","vTextureCoord.z = floor(floor(a_customAttributes / 4.)/u_tilesPerTexture);","}"].join("\n");}},{"./webgl.js":53,"./webglAtlas.js":54}],57:[function(require,module,exports){var documentEvents=require('../Utils/documentEvents.js');module.exports=webglInputEvents;function webglInputEvents(webglchartViewics){if(webglchartViewics.webglInputEvents){return webglchartViewics.webglInputEvents;}
var mouseCapturedNode=null,mouseEnterCallback=[],mouseLeaveCallback=[],mouseDownCallback=[],mouseUpCallback=[],mouseMoveCallback=[],clickCallback=[],dblClickCallback=[],prevSelectStart,boundRect;var root=webglchartViewics.getchartViewicsRoot();startListen(root);var api={mouseEnter:mouseEnter,mouseLeave:mouseLeave,mouseDown:mouseDown,mouseUp:mouseUp,mouseMove:mouseMove,click:click,dblClick:dblClick,mouseCapture:mouseCapture,releaseMouseCapture:releaseMouseCapture};webglchartViewics.webglInputEvents=api;return api;function releaseMouseCapture(){mouseCapturedNode=null;}
function mouseCapture(node){mouseCapturedNode=node;}
function dblClick(callback){if(typeof callback==='function'){dblClickCallback.push(callback);}
return api;}
function click(callback){if(typeof callback==='function'){clickCallback.push(callback);}
return api;}
function mouseMove(callback){if(typeof callback==='function'){mouseMoveCallback.push(callback);}
return api;}
function mouseUp(callback){if(typeof callback==='function'){mouseUpCallback.push(callback);}
return api;}
function mouseDown(callback){if(typeof callback==='function'){mouseDownCallback.push(callback);}
return api;}
function mouseLeave(callback){if(typeof callback==='function'){mouseLeaveCallback.push(callback);}
return api;}
function mouseEnter(callback){if(typeof callback==='function'){mouseEnterCallback.push(callback);}
return api;}
function preciseCheck(nodeUI,x,y){if(nodeUI&&nodeUI.size){var pos=nodeUI.position,half=nodeUI.size;return pos.x-half<x&&x<pos.x+half&&pos.y-half<y&&y<pos.y+half;}
return true;}
function getNodeAtClientPos(pos){return webglchartViewics.getNodeAtClientPos(pos,preciseCheck);}
function stopPropagation(e){if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;}}
function handleDisabledEvent(e){stopPropagation(e);return false;}
function invoke(callbacksChain,args){var i,stopPropagation;for(i=0;i<callbacksChain.length;i+=1){stopPropagation=callbacksChain[i].apply(undefined,args);if(stopPropagation){return true;}}}
function startListen(root){var pos={x:0,y:0},lastFound=null,lastUpdate=1,lastClickTime=+new Date(),handleMouseMove=function(e){invoke(mouseMoveCallback,[lastFound,e]);pos.x=e.clientX;pos.y=e.clientY;},handleMouseUp=function(){documentEvents.off('mousemove',handleMouseMove);documentEvents.off('mouseup',handleMouseUp);},updateBoundRect=function(){boundRect=root.getBoundingClientRect();};window.addEventListener('resize',updateBoundRect);updateBoundRect();root.addEventListener('mousemove',function(e){if(mouseCapturedNode){return;}
if(lastUpdate++%7===0){updateBoundRect();lastUpdate=1;}
var cancelBubble=false,node;pos.x=e.clientX-boundRect.left;pos.y=e.clientY-boundRect.top;node=getNodeAtClientPos(pos);if(node&&lastFound!==node){lastFound=node;cancelBubble=cancelBubble||invoke(mouseEnterCallback,[lastFound]);}else if(node===null&&lastFound!==node){cancelBubble=cancelBubble||invoke(mouseLeaveCallback,[lastFound]);lastFound=null;}
if(cancelBubble){stopPropagation(e);}});root.addEventListener('mousedown',function(e){var cancelBubble=false,args;updateBoundRect();pos.x=e.clientX-boundRect.left;pos.y=e.clientY-boundRect.top;args=[getNodeAtClientPos(pos),e];if(args[0]){cancelBubble=invoke(mouseDownCallback,args);documentEvents.on('mousemove',handleMouseMove);documentEvents.on('mouseup',handleMouseUp);prevSelectStart=window.document.onselectstart;window.document.onselectstart=handleDisabledEvent;lastFound=args[0];}else{lastFound=null;}
if(cancelBubble){stopPropagation(e);}});root.addEventListener('mouseup',function(e){var clickTime=+new Date(),args;pos.x=e.clientX-boundRect.left;pos.y=e.clientY-boundRect.top;var nodeAtClientPos=getNodeAtClientPos(pos);var sameNode=nodeAtClientPos===lastFound;args=[nodeAtClientPos||lastFound,e];if(args[0]){window.document.onselectstart=prevSelectStart;if(clickTime-lastClickTime<400&&sameNode){invoke(dblClickCallback,args);}else{invoke(clickCallback,args);}
lastClickTime=clickTime;if(invoke(mouseUpCallback,args)){stopPropagation(e);}}});}}},{"../Utils/documentEvents.js":40}],58:[function(require,module,exports){var parseColor=require('./parseColor.js');module.exports=webglLine;function webglLine(color){return{color:parseColor(color)};}},{"./parseColor.js":51}],59:[function(require,module,exports){var glUtils=require('./webgl.js');module.exports=webglLinkProgram;function webglLinkProgram(){var ATTRIBUTES_PER_PRIMITIVE=6,BYTES_PER_LINK=2*(2*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT),linksFS=['precision mediump float;','varying vec4 color;','void main(void) {','   gl_FragColor = color;','}'].join('\n'),linksVS=['attribute vec2 a_vertexPos;','attribute vec4 a_color;','uniform vec2 u_screenSize;','uniform mat4 u_transform;','varying vec4 color;','void main(void) {','   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0.0, 1.0);','   color = a_color.abgr;','}'].join('\n'),program,gl,buffer,utils,locations,linksCount=0,frontLinkId,storage=new ArrayBuffer(16*BYTES_PER_LINK),positions=new Float32Array(storage),colors=new Uint32Array(storage),width,height,transform,sizeDirty,ensureEnoughStorage=function(){if((linksCount+1)*BYTES_PER_LINK>storage.byteLength){var extendedStorage=new ArrayBuffer(storage.byteLength*2),extendedPositions=new Float32Array(extendedStorage),extendedColors=new Uint32Array(extendedStorage);extendedColors.set(colors);positions=extendedPositions;colors=extendedColors;storage=extendedStorage;}};return{load:function(glContext){gl=glContext;utils=glUtils(glContext);program=utils.createProgram(linksVS,linksFS);gl.useProgram(program);locations=utils.getLocations(program,['a_vertexPos','a_color','u_screenSize','u_transform']);gl.enableVertexAttribArray(locations.vertexPos);gl.enableVertexAttribArray(locations.color);buffer=gl.createBuffer();},position:function(linkUi,fromPos,toPos){var linkIdx=linkUi.id,offset=linkIdx*ATTRIBUTES_PER_PRIMITIVE;positions[offset]=fromPos.x;positions[offset+1]=fromPos.y;colors[offset+2]=linkUi.color;positions[offset+3]=toPos.x;positions[offset+4]=toPos.y;colors[offset+5]=linkUi.color;},createLink:function(ui){ensureEnoughStorage();linksCount+=1;frontLinkId=ui.id;},removeLink:function(ui){if(linksCount>0){linksCount-=1;}
if(ui.id<linksCount&&linksCount>0){utils.copyArrayPart(colors,ui.id*ATTRIBUTES_PER_PRIMITIVE,linksCount*ATTRIBUTES_PER_PRIMITIVE,ATTRIBUTES_PER_PRIMITIVE);}},updateTransform:function(newTransform){sizeDirty=true;transform=newTransform;},updateSize:function(w,h){width=w;height=h;sizeDirty=true;},render:function(){gl.useProgram(program);gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,storage,gl.DYNAMIC_DRAW);if(sizeDirty){sizeDirty=false;gl.uniformMatrix4fv(locations.transform,false,transform);gl.uniform2f(locations.screenSize,width,height);}
gl.vertexAttribPointer(locations.vertexPos,2,gl.FLOAT,false,3*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(locations.color,4,gl.UNSIGNED_BYTE,true,3*Float32Array.BYTES_PER_ELEMENT,2*4);gl.drawArrays(gl.LINES,0,linksCount*2);frontLinkId=linksCount-1;},bringToFront:function(link){if(frontLinkId>link.id){utils.swapArrayPart(positions,link.id*ATTRIBUTES_PER_PRIMITIVE,frontLinkId*ATTRIBUTES_PER_PRIMITIVE,ATTRIBUTES_PER_PRIMITIVE);}
if(frontLinkId>0){frontLinkId-=1;}},getFrontLinkId:function(){return frontLinkId;}};}},{"./webgl.js":53}],60:[function(require,module,exports){var glUtils=require('./webgl.js');module.exports=webglNodeProgram;function webglNodeProgram(){var ATTRIBUTES_PER_PRIMITIVE=4;var BYTES_PER_NODE=3*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT;var nodesFS=['precision mediump float;','varying vec4 color;','void main(void) {','   gl_FragColor = color;','}'].join('\n');var nodesVS=['attribute vec3 a_vertexPos;','attribute vec4 a_color;','uniform vec2 u_screenSize;','uniform mat4 u_transform;','varying vec4 color;','void main(void) {','   gl_Position = u_transform * vec4(a_vertexPos.xy/u_screenSize, 0, 1);','   gl_PointSize = a_vertexPos.z * u_transform[0][0];','   color = a_color.abgr;','}'].join('\n');var program;var gl;var buffer;var locations;var utils;var storage=new ArrayBuffer(16*BYTES_PER_NODE);var positions=new Float32Array(storage);var colors=new Uint32Array(storage);var nodesCount=0;var width;var height;var transform;var sizeDirty;return{load:load,position:position,updateTransform:updateTransform,updateSize:updateSize,removeNode:removeNode,createNode:createNode,replaceProperties:replaceProperties,render:render};function ensureEnoughStorage(){if((nodesCount+1)*BYTES_PER_NODE>=storage.byteLength){var extendedStorage=new ArrayBuffer(storage.byteLength*2),extendedPositions=new Float32Array(extendedStorage),extendedColors=new Uint32Array(extendedStorage);extendedColors.set(colors);positions=extendedPositions;colors=extendedColors;storage=extendedStorage;}}
function load(glContext){gl=glContext;utils=glUtils(glContext);program=utils.createProgram(nodesVS,nodesFS);gl.useProgram(program);locations=utils.getLocations(program,['a_vertexPos','a_color','u_screenSize','u_transform']);gl.enableVertexAttribArray(locations.vertexPos);gl.enableVertexAttribArray(locations.color);buffer=gl.createBuffer();}
function position(nodeUI,pos){var idx=nodeUI.id;positions[idx*ATTRIBUTES_PER_PRIMITIVE]=pos.x;positions[idx*ATTRIBUTES_PER_PRIMITIVE+1]=-pos.y;positions[idx*ATTRIBUTES_PER_PRIMITIVE+2]=nodeUI.size;colors[idx*ATTRIBUTES_PER_PRIMITIVE+3]=nodeUI.color;}
function updateTransform(newTransform){sizeDirty=true;transform=newTransform;}
function updateSize(w,h){width=w;height=h;sizeDirty=true;}
function removeNode(node){if(nodesCount>0){nodesCount-=1;}
if(node.id<nodesCount&&nodesCount>0){utils.copyArrayPart(colors,node.id*ATTRIBUTES_PER_PRIMITIVE,nodesCount*ATTRIBUTES_PER_PRIMITIVE,ATTRIBUTES_PER_PRIMITIVE);}}
function createNode(){ensureEnoughStorage();nodesCount+=1;}
function replaceProperties(){}
function render(){gl.useProgram(program);gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,storage,gl.DYNAMIC_DRAW);if(sizeDirty){sizeDirty=false;gl.uniformMatrix4fv(locations.transform,false,transform);gl.uniform2f(locations.screenSize,width,height);}
gl.vertexAttribPointer(locations.vertexPos,3,gl.FLOAT,false,ATTRIBUTES_PER_PRIMITIVE*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(locations.color,4,gl.UNSIGNED_BYTE,true,ATTRIBUTES_PER_PRIMITIVE*Float32Array.BYTES_PER_ELEMENT,3*4);gl.drawArrays(gl.POINTS,0,nodesCount);}}},{"./webgl.js":53}],61:[function(require,module,exports){var parseColor=require('./parseColor.js');module.exports=webglSquare;function webglSquare(size,color){return{size:typeof size==='number'?size:10,color:parseColor(color)};}},{"./parseColor.js":51}],62:[function(require,module,exports){module.exports='0.8.1';},{}]},{},[1])(1)});